{
  "hash": "87c4914545498408d921791f6b34b44a",
  "result": {
    "markdown": "---\ntitle: Matching and Re-weighting\nsubtitle: When X differ...\nauthor: Fernando Rios-Avila\nformat:\n  revealjs:\n    slide-number: true\n    width: 1500\n    height: 900\n    code-overflow: scroll\n    theme: simple\n---\n\n## Recap: Potential outcomes and Identification\n\nTo identify treatment effects one could just compare potential outcomes in two states:\n\n - with treatment\n - without treament\n\nMathematically:\n$$\nATE = E(Y_i(1)-Y_i(0))\n$$\n\nthe problem: with real data, we are only able to see one outcome. The counterfactual is not observed:\n\n$$\nY_i = Y_i(1)*D + Y_i(0)*(1-D)\n$$\n\nand simple differences may not capture ATE, because of selection bias and heterogeneity\n\n## Recap: Gold Standard - RCT\n\nThe easiest, but most expensive, way to deal with the problem is using **Randomized Control Trials**.\n\nEffectily, you randomize Treatment, so that potential outcomes are independent of treatment:\n\n$$Y(1),Y(0) \\perp D\n$$\n\nIn other words, the distribution of potential outcomes is the same for those treated or untreated units.\n\n$$\n\\begin{aligned}\nE(Y,D=1)&=E(Y(1),D=1)=E(Y(1),D=0) \\\\\nE(Y,D=0)&=E(Y(0),D=1)=E(Y(0),D=0) \\\\\nATT&=E(Y,D=1) - E(Y,D=0)\n\\end{aligned}\n$$\n\n# But what if you can't Randomize {background-color=\"#447099\"}\n\n## When unconditional fails\n\nMore often than not, specially if we didnt construct the data, it would be impossible to find that unconditional independence assumption holds. \n\nFor example, treatment (say having health insurance) may vary by age, gender, race, location, etc.\n\nThis is similar to the selection bias: Outcomes across treated and untreated groups will be different because of:\n\n- Treatment \n\n- Composition: Characteristics of people among the treated could be different than those among the untreated\n    For example, they could be older, more educated, mostly men, etc.\n\n- Other factors: There could be factors we cannot control for, that also affect outcomes.\n\n## There is conditional\n\nWhen unconditional independence assumption fails, we can call on Conditional independence assumption:\n\n$$\nY(1),Y(0) \\perp D | X\n$$\n\nIn other words, If we can look into specific groups (given $X$), it may be possible to impose the Independence assumption.\n\nThis relaxes the independence condition, but assumes selection is due to observable characteristics only.\n(but it still needs to be as good as randomized)\n\nImplications:\n\n$$\n\\begin{aligned}\nE(Y|D=1,X) =E(Y(1)|D=1,X)=E(Y(1)|D=0,X)  \\\\\nE(Y|D=0,X) =E(Y(0)|D=1,X)=E(Y(0)|D=0,X) \n\\end{aligned}\n$$\n\n## Intuition\n\nMatching is a methodology that falls within quasi-experimental designs. You cannot or could not decide the assigment rules, so now are using data as given.\n\nThe idea is to construct an artificial control and use it as a counterfactual, so that both treated and control groups \"look the same\". \n\nOnce a group of syntethic controls has been constructed, treatment effects can be calculated for the whole population:\n\n$$\n\\begin{aligned}\nATE(X) &= E(Y|D=1,X) -E(Y|D=0,X) \\\\\nATE &= \\int ATE(X) dFx \n\\end{aligned}\n$$\n\nHow can we do this?\n\n## Subclassification or stratification\n\nConsider the following dataset:\n\n::: {.cell execution_count=1}\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n(Data downloaded from R base)\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n           |        class1\n  Survived |         0          1 |     Total\n-----------+----------------------+----------\n        No |     72.92      37.54 |     67.70 \n       Yes |     27.08      62.46 |     32.30 \n-----------+----------------------+----------\n     Total |    100.00     100.00 |    100.00 \n```\n:::\n:::\n\n\nIf we assume full Independence assumption we would  believe that being in first class increased chance of survival in 35.4%. but is that the case?\n\nWhat if the composition of individuals change across classes (women and children)\n\n::: {.cell execution_count=2}\n\n::: {.cell-output .cell-output-stdout}\n```\n(Data downloaded from R base)\n\n           |        class1\n       Age |         0          1 |     Total\n-----------+----------------------+----------\n     Child |      5.49       1.85 |      4.95 \n     Adult |     94.51      98.15 |     95.05 \n-----------+----------------------+----------\n     Total |    100.00     100.00 |    100.00 \n\n           |        class1\n       Sex |         0          1 |     Total\n-----------+----------------------+----------\n      Male |     82.68      55.38 |     78.65 \n    Female |     17.32      44.62 |     21.35 \n-----------+----------------------+----------\n     Total |    100.00     100.00 |    100.00 \n```\n:::\n:::\n\n\nThere were fewer children, but more women in first class. Perhaps that explains the difference in survival rates\n\n",
    "supporting": [
      "matching_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}