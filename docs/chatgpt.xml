<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Playing With Stata</title>
<link>https://friosavila.github.io/chatgpt.html</link>
<atom:link href="https://friosavila.github.io/chatgpt.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.5.56</generator>
<lastBuildDate>Tue, 06 Aug 2024 04:00:00 GMT</lastBuildDate>
<item>
  <title>Stata Crash Course: Graphs and EDA</title>
  <dc:creator>Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/stata_08_06_2024/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The last part of the series of Stata Basics: Graphs! In this quick tutorial should provide you with a solid foundation for creating high-quality graphs in Stata. Granted, Stata’s graphing capabilities are not as flexible and fast as R or Python, but they are still powerful and can produce almost every type of graph you might need.</p>
<p>But before we start, a brief comment on graphs in Stata. One of the most important things when making good graphs is to choose good colors, and good schemes (or themes). Up to Stata 17, the default color scheme was <code>s2color</code>, which is not the best. In Stata 18, a new color scheme was introduced, which is more visually appealing. Of course, if you have an earlier version of Stata, you may want to consider other options.</p>
<p>So, to get you in the right path, you may want to first get few things installed in your Stata.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1">net install palettes , <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> from(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/benjann/palettes/master/"</span>)</span>
<span id="cb1-2">net install colrspace, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> from(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/benjann/colrspace/master/"</span>)</span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ssc</span> install grstyle</span>
<span id="cb1-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ssc</span> install color_style</span></code></pre></div>
<p><code>palette</code> and <code>colrspace</code>, both by Ben Jann, are packages that allow you to easily create colors that can be used as part of your scheme. <code>grstyle</code>, also by Ben Jann, is another small tool that is very useful to make changes in the scheme files.</p>
<p>Finally, a small wrapper of my own design: <code>color_style</code>. This package uses the previous ones for one main purpose. Change the color palettes used in the current scheme. That way, you do not need to make changes manually, and can easily change colors as needed. Now a quick setup:</p>
<div id="78ae9ffd" class="cell" data-outcome="false" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">set</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">scheme</span> white2</span>
<span id="cb2-2">color_style tableau</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>
</div>
</div>
<section id="why-data-visualization-matters" class="level2">
<h2 class="anchored" data-anchor-id="why-data-visualization-matters">Why Data Visualization Matters</h2>
<p>Before we start with the guide, a quick word on why data visualization matters the data analysis process:</p>
<ol type="1">
<li><strong>Exploratory Data Analysis (EDA)</strong>: Visualizations help you understand the structure of your data, identify patterns, and spot anomalies or outliers.</li>
<li><strong>Hypothesis Generation</strong>: Graphs can reveal relationships between variables that you might not have anticipated, leading to new research questions.</li>
<li><strong>Communication</strong>: A well-designed graph can show information quickly and effectively to your audience.</li>
<li><strong>Quality Control</strong>: Visualizations can help you identify data quality issues or errors in your analysis.</li>
</ol>
<p>With these benefits in mind, let’s begin!</p>
</section>
<section id="getting-started-with-stata-graphs" class="level2">
<h2 class="anchored" data-anchor-id="getting-started-with-stata-graphs">Getting Started with Stata Graphs</h2>
<p>Before we start making graphs, let’s start with a brief overview of Stata’s graphing syntax and some basic principles.</p>
<section id="statas-graph-syntax" class="level3">
<h3 class="anchored" data-anchor-id="statas-graph-syntax">Stata’s Graph Syntax</h3>
<p>Most Stata graph commands follow a similar structure:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1">graph_type y_variable(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>) [x_variable] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span>] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span>] [, options]</span></code></pre></div>
<p>Where: - <code>graph_type</code> is the type of graph you want to create (e.g., scatter, line, bar) - <code>y_variable</code> is typically the dependent variable - <code>x_variable</code> is typically the independent variable - <code>[if]</code> and <code>[in]</code> are optional conditions to subset your data - <code>[weight]</code> is an optional weighting specification - <code>[, options]</code> are additional specifications to customize your graph</p>
<p>In terms of Graph Types, we could possibly classify them into two main categories. you have the <code>two way</code> graphs, and the <code>graph</code> graphs.</p>
<p>The first type are graphs that can be overlaid on top of each other. The second, however, cannot be overlay. In addition to that, most community-contributed commands are typically <code>two way</code> graphs. However, they cannot be <code>overlayed</code> with the official ones. Which Its perhaps the biggest weakness of Stata’s graphical capabilities.</p>
</section>
</section>
<section id="your-first-stata-graph" class="level2">
<h2 class="anchored" data-anchor-id="your-first-stata-graph">Your First Stata Graph</h2>
<p>Let’s create a simple scatter plot to get started. We’ll use the built-in “auto” dataset:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> auto, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span></span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span>, <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miles per Gallon vs. Weight"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/// Adds a title</span></span>
<span id="cb4-5">                    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight (lbs)"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/// label to the x-axis</span></span>
<span id="cb4-6">                    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miles per Gallon"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// and y-axis </span></span></code></pre></div>
<p>Done!</p>
<p>Now some points to consider. <code>title</code> is important, but often you may want to add a title in your editor, not the figure. Same if you add a note. Otherwise, the above code is a good start.</p>
<p>Also noticed that because of my setup using <code>white2</code> scheme, the background is white, and minimalistic. The colors, from <code>tableau</code> are generally a good choice for most graphs.</p>
<p>Wait, but how does this look like? Let’s see:</p>
<div id="fd50c8a7" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> auto, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb5-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span>, <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miles per Gallon vs. Weight"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/// Adds a title</span></span>
<span id="cb5-3">                    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight (lbs)"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/// label to the x-axis</span></span>
<span id="cb5-4">                    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miles per Gallon"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/// and y-axis </span></span>
<span id="cb5-5">                    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.5)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(1978 automobile data)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-3-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>From here on, I will produce the figures directly, and you can check the code to reproduce them in your own work.</p>
</section>
</section>
<section id="graph-types" class="level1">
<h1>Graph Types</h1>
<section id="scatter-plots" class="level2">
<h2 class="anchored" data-anchor-id="scatter-plots">Scatter Plots</h2>
<p>Scatter plots, what we just did, its perhaps the most basic plot you will use. They are excellent for visualizing the relationship between two <strong>continuous</strong> variables. They can reveal patterns, correlations, and outliers in your data.</p>
<p>The basic syntax for a scatter plot is:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">varlist</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">y</span>] [xvar] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span>] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span>] [, options]</span></code></pre></div>
<p>As you may expect, <code>varlist y</code> can be a list of variables, all which will be plotted against <code>xvar</code>. However, I would recommend you to use only one variable at a time.</p>
<p>If multiple variables are required, you can use <code>twoway</code> to overlay them.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">twoway</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> [yvar1] [xvar] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span>] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span>] [, options]) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/// &lt;-first</span></span>
<span id="cb8-2">       (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> [yvar2] [xvar] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span>] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span>] [, options]) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// &lt;-second</span></span></code></pre></div>
<p>Each scatter plot can have its own options, colors, and labels.</p>
<p>For example:</p>
<div id="4c1039ab" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> auto, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb9-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">twoway</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> foreign==0) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb9-3">       (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> foreign==1) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb9-4">        , <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miles per Gallon vs. Weight: By foreign"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb9-5">          <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight (lbs)"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb9-6">          <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miles per Gallon"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb9-7">          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.5) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb9-8">          <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Domestic"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Foreign"</span>) )</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(1978 automobile data)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-4-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Now this plot is combining various features.</p>
<ul>
<li>The <code>twoway</code> command (<code>two</code> for short) is used to overlay the two scatter plots.</li>
<li><code>legend</code> adds a legend to the graph, specifying the order of the labels. In <code>white2</code> scheme, the legend is at the left of the graph.<br>
If you would like to change the position of the legend, you can use <code>position(#)</code>, where <code>#</code> is a number from 1 to 12. You may also want to use <code>cols(#)</code> or <code>rows()</code> to change the layout of the legend.</li>
</ul>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb11-1"><span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Domestic"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Foreign"</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">position</span>(3) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">cols</span>(1))</span></code></pre></div>
<section id="customizing-markers" class="level3">
<h3 class="anchored" data-anchor-id="customizing-markers">Customizing Markers</h3>
<p>You can change the appearance of the markers using various options, like <code>mcolor()</code>, <code>msymbol()</code>, or <code>msize()</code>. From all of these, I prefer using <code>pstyle()</code> to change the colors, and other options for the size of shape, because <code>pstyle()</code> is connected to the color scheme you are using, and <code>mcolor()</code> for added options like transparency. Lets try this with the previous example:</p>
<div id="14b6dfa1" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb12-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> auto, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb12-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">twoway</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> foreign==0, pstyle(p3) msize(2)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb12-3">       (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> foreign==1, pstyle(p5) mcolor(%50)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb12-4">        , <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miles per Gallon vs. Weight: By foreign"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb12-5">          <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight (lbs)"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb12-6">          <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miles per Gallon"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb12-7">          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.5) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb12-8">          <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Domestic"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Foreign"</span>) )</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(1978 automobile data)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-5-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="other-interesting-options" class="level3">
<h3 class="anchored" data-anchor-id="other-interesting-options">Other interesting options</h3>
<p>There are other options you may want to try. For example, <code>mlabel()</code> and <code>mlabsize()</code> to add labels to the points. Just be careful with the size of the labels, as the figure could become very busy. If you try the code below, you will see that the figure is not very informative.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span>, <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">mlabel</span>(make) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb14-2">                    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">mlabsize</span>(tiny)</span></code></pre></div>
<p>This adds the car make as a label to each point.</p>
</section>
<section id="advanced-scatter-plot" class="level3">
<h3 class="anchored" data-anchor-id="advanced-scatter-plot">Advanced Scatter Plot</h3>
<p>Let’s combine several elements to create a more informative scatter plot:</p>
<div id="f041dddc" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb15-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span>, mcolor(%30) msize(5) ) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb15-2">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> 1/5,  pstyle(p1) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">mlabel</span>(make) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">mlabsize</span>(small) ), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb15-3">                    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MPG vs. Weight"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb15-4">                    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">subtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1978 Automobile Data"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb15-5">                    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight (lbs)"</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miles per Gallon"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb15-6">                    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source: Auto dataset"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb15-7">                    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.4)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-6-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This plot includes: - Semi-transparent circles - Labels for few points (car make) - Informative title, subtitle, and axis labels - A note indicating the data source - No legend (turned off) (every time you have more than 1 plot, the legend will be displayed)</p>
</section>
<section id="a-different-type-of-scatter-plot" class="level3">
<h3 class="anchored" data-anchor-id="a-different-type-of-scatter-plot">A Different type of scatter Plot</h3>
<p>While you can always use scatter plot for plotting multiple multiple variables, any now and then you will need a more “brute force approach”, where a large set of variables are plotted at aonce. If you are interested in this, you can use a scatter plot matrix. It has the following syntax:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb16-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">graph</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span> [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">varlist</span>], [half]</span></code></pre></div>
<p>Where <code>varlist</code> is a list of variables to be plotted. This will make a matrix of scatter plots for all pairs of the specified variables. The <code>half</code> option will only plot the lower half of the matrix. Of course, such a plot can be very busy, so be careful with the number of variables you include. Here an example:</p>
<div id="4fac8904" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb17-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">graph</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span> price mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>, half <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb17-2">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xsize</span>(12) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ysize</span>(8) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scatter Plot Matrix"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-7-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="line-plots" class="level2">
<h2 class="anchored" data-anchor-id="line-plots">Line Plots</h2>
<p>Line plots are the second most common type of plot you will use. They are excellent for visualizing trends over time or another continuous variable.</p>
<p>In general, I would classify them in three types. The basic line plot, and model based line plots.</p>
<p>The basic lineplot is the one that uses all the data to create a plot, going from one coordinate to the next. Think of it as a connect the dots plot. Because of this, the plot can be very different depending on the order of the data.</p>
<p>The model based plot is often more useful, as it uses some univariate model (linear, quadratic, etc) to create the line. This is often more useful, as it can show the trend of the data, without the noise.</p>
<p>Lets start with the basic line plot:</p>
<section id="basic-line-plot" class="level3">
<h3 class="anchored" data-anchor-id="basic-line-plot">Basic Line Plot</h3>
<p>Similar to scatter plots, you can use multiple variables in a line plot, to be plotted against a single variable.</p>
<div id="e0eaf1b9" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb18-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> uslifeexp, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb18-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> le_w le_m <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb18-3">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(Life expectancy <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> men and women <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">over</span> time)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(U.S. life expectancy, 1900-1999)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-8-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Which works well, because the data was ordered by year. If i were to order it by Life expectancy, the plot would be very different, bordering non-sensical.</p>
<div id="4d7ef987" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb20-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> uslifeexp, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb20-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span> le_w</span>
<span id="cb20-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> le_w le_m <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb20-4">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(Life expectancy <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> men and women <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">over</span> time)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(U.S. life expectancy, 1900-1999)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-9-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="customizing-line-styles" class="level3">
<h3 class="anchored" data-anchor-id="customizing-line-styles">Customizing Line Styles</h3>
<p>This plot allows for a few customizations. For example, you can change the line style, color, and width:</p>
<div id="ee29b67e" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb22-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span></span>
<span id="cb22-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> le_w le_m <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>, lpattern(solid <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">dash</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb22-3">            pstyle(p2 p3) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb22-4">            lwidth(thick medium) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb22-5">            <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xline</span>(1930/1936, lw(2) lp(solid) lcolor(gs12)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb22-6">            <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(Life expectancy <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> men and women <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">over</span> time)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-10-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In addition to the line, I also added some shading for the years 1930 to 1936. Useful if you want to emphasize a particular period.</p>
</section>
<section id="advanced-customization" class="level3">
<h3 class="anchored" data-anchor-id="advanced-customization">Advanced Customization</h3>
<p>As with Scatter plot, and infact most two-way plots, you can customize the plot in many ways.</p>
<div id="ec4a086c" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb23-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> le_w le_m <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>, lpattern(solid <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">dash</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb23-2">                     lcolor(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">red</span> <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">blue</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb23-3">                     lwidth(<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">medthick</span> medium) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb23-4">                     <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Life Expectancy Trends"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb23-5">                     <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">subtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"United States, 1900-2000"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb23-6">                     <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Life Expectancy (years)"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb23-7">                     <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ylabel</span>(40(10)80, angle(0)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb23-8">                     <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">xlabel</span>(1900(20)2000) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb23-9">                     <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Women"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Men"</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb23-10">                     <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source: US Life Expectancy dataset"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-11-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-based-line-plot" class="level3">
<h3 class="anchored" data-anchor-id="model-based-line-plot">Model based line plot</h3>
<p>Something that its recommended to use more often are model-based line plots. That means that you are not plotting the data, but the predictions of a model. This is useful to better see patterns when the data is noisy.</p>
<p>Lets use the <code>dui</code> dataset and produce a combination of scatter plot with a line plot. On top of that, we will use confidence intervals. (typically means adding a <code>ci</code> to the command)</p>
<p>Lets see how they look like:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">Linear Fit</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">Quadratic Fit</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false">NonParametric Fit</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div id="8774ac51" class="cell" data-outcome="false" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb24-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">webuse</span> dui, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb24-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> citations fines) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb24-3">    (lfitci citations fines,  fcolor(%40)) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb24-4">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.4) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb24-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Citations"</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fines in 000$"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Fictional data on monthly drunk driving citations)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-12-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<div id="7fb6a64d" class="cell" data-outcome="false" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb26-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">webuse</span> dui, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb26-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> citations fines) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb26-3">    (qfitci citations fines,  fcolor(%40)) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb26-4">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.4) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb26-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Citations"</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fines in 000$"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Fictional data on monthly drunk driving citations)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-13-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<div id="ebf20d53" class="cell" data-outcome="false" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb28-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">webuse</span> dui, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb28-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> citations fines) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb28-3">    (lpolyci citations fines,  fcolor(%40)) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb28-4">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.4) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb28-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Citations"</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fines in 000$"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Fictional data on monthly drunk driving citations)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-14-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="histograms-density-plots-and-box-plots" class="level2">
<h2 class="anchored" data-anchor-id="histograms-density-plots-and-box-plots">Histograms, Density Plots and Box Plots</h2>
<p>When it comes to visualizing the distribution of a single variable, your main options are histograms, density plots, and box plots. Histograms and <code>kdensity</code> plots are both <code>twoway</code> plots that can be overlayed. Box plots, however, are <code>graph</code> plots, and are a bit more temperamental.</p>
<section id="histograms" class="level3">
<h3 class="anchored" data-anchor-id="histograms">Histograms</h3>
<p>The first command we will see is the <code>histogram</code> command. This command is used to create histograms, which are bar charts that show the frequency distribution of a single variable.</p>
<p>In contrast with frequency tables, where you need to define the bins width or number of bins, histograms will do this for you. Not always in the best way, but it will do it.</p>
<p>The basic syntax for a histogram is:</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb30-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">histogram</span> [varname] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span>] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span>] [, options]</span></code></pre></div>
<p>Perhaps the biggest complain I have about histograms is that they do not allow for aweights. So if your weights are fractional, you may need to consider other works around.</p>
<p>Lets see how this works</p>
</section>
<section id="basic-histogram" class="level3">
<h3 class="anchored" data-anchor-id="basic-histogram">Basic Histogram</h3>
<p>The basic histogram plot will try to produce densities on the y-axis. It usually labels it correctly.</p>
<p>You can, however, request <code>frequency</code> or <code>percent</code> on the y-axis.</p>
<div id="a8eaa820" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb31-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">webuse</span> dui, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb31-2"></span>
<span id="cb31-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">histogram</span> fines, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb31-4">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram of Fines"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb31-5">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fines in 000$"</span>) </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Fictional data on monthly drunk driving citations)
(bin=22, start=7.4000001, width=.2090909)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-15-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>By default, histogram will calculate the number of bins for you. However, you can specify the number of bins using the <code>bin()</code> option. Alternatively, you can use <code>width()</code> instead, making it either more or less granular.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" aria-controls="tabset-2-1" aria-selected="true">Wider Width()</a></li><li class="nav-item"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" aria-controls="tabset-2-2" aria-selected="false">Narrower Width()</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" aria-labelledby="tabset-2-1-tab">
<div id="0eb8780e" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb33-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">histogram</span> fines, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb33-2">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram of Fines"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb33-3">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fines in 000$"</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">width</span>(.4)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(bin=12, start=7.4000001, width=.4)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-16-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" aria-labelledby="tabset-2-2-tab">
<div id="8d715ed3" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb35-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">histogram</span> fines, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb35-2">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram of Fines"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb35-3">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fines in 000$"</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">width</span>(.1)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(bin=46, start=7.4000001, width=.1)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-17-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Wider bins will make the plot more general, but you lose some of the detail. Narrower bins will make the plot more detailed, but you may lose the overall picture. Its the classic bias-variance tradeoff.</p>
</section>
<section id="overlaying-histograms" class="level3">
<h3 class="anchored" data-anchor-id="overlaying-histograms">Overlaying Histograms</h3>
<p>As mentioned before, because histograms are <code>twoway</code> plots, you can overlay them. This is useful when you want to compare the distribution of a variable across different groups (Low number of groups). Note that by default, histograms come with just one color, but you can change this using the <code>pstyle()</code> option.</p>
<p>You may want to use transparency to make the plot more readable. and even use other options to make the plot visually appealing.</p>
<p>For the last example, I will also use a <code>global</code> to pass options that are common to all subplots.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" aria-controls="tabset-3-1" aria-selected="true">Simple Overlap</a></li><li class="nav-item"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" aria-controls="tabset-3-2" aria-selected="false">With Transparency</a></li><li class="nav-item"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" aria-controls="tabset-3-3" aria-selected="false">Fixing widths</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" aria-labelledby="tabset-3-1-tab">
<div id="ab0176e4" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb37-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">histogram</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==1, pstyle(p1)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb37-2">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">histogram</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==2, pstyle(p2)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb37-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">histogram</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==3, pstyle(p3)) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb37-4">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram of citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb37-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">subtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"By city Size"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb37-6">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fines in 000$"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb37-7">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Small"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medium"</span> 3 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Large"</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-18-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" aria-labelledby="tabset-3-2-tab">
<div id="7e6b6d46" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb38-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">histogram</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==1, pstyle(p1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(%75)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb38-2">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">histogram</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==2, pstyle(p2) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(%75)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb38-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">histogram</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==3, pstyle(p3) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(%75)), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb38-4">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram of citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb38-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">subtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"By city Size"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb38-6">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fines in 000$"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb38-7">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Small"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medium"</span> 3 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Large"</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-19-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" aria-labelledby="tabset-3-3-tab">
<div id="3cabfd2f" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb39-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">global</span> options <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">width</span>(3) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">start</span>(0) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(%55)</span>
<span id="cb39-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">histogram</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==1, pstyle(p1) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$options</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb39-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">histogram</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==2, pstyle(p2) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$options</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb39-4">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">histogram</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==3, pstyle(p3) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$options</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb39-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram of citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb39-6">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">subtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"By city Size"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb39-7">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fines in 000$"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb39-8">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Small"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medium"</span> 3 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Large"</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-20-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>One more note. Histograms assume your dependent variable is continuous. However, you could also use them as discrete, by simply adding the <code>discrete</code> option. Unless <code>width()</code> is specified, each bar will represent a single value.</p>
</section>
</section>
<section id="kernel-density-plots" class="level2">
<h2 class="anchored" data-anchor-id="kernel-density-plots">Kernel Density Plots</h2>
<p>As mentione before, histograms are a good way to visualize distributions of a single variable. Something that histograms do not do well is provide a smooth estimate of the probability density function. And, in Stata, its not possible to add fractional weights to histograms.</p>
<p>There is, however, another option. Kernel Density Plots. These plots provide a smooth estimate of the probability density function of a variable. As with Histograms, they can be very sensitive to the choice of bandwidth (how smooth or rugged the plot is).</p>
<p>One should also note that Kernel density plots cannot be used to plot distributions of discrete variables, and may provide misleading results if used with data that have constraints, or very relevant modes.</p>
<p>The basic syntax for a kernel density plot is:</p>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb40-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> [varname] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span>] [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span>] [, options]</span></code></pre></div>
<p>And because its a <code>twoway</code> plot, you can overlay them with other plots.</p>
<section id="basic-kernel-density-plot" class="level3">
<h3 class="anchored" data-anchor-id="basic-kernel-density-plot">Basic Kernel Density Plot</h3>
<p>Lets see how this works with the <code>dui</code> dataset.</p>
<div id="7161ad7c" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb41-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">webuse</span> dui, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb41-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> citation, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb41-3">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kernel Density Estimate of Citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb41-4">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"# of Citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb41-5">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.5) </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Fictional data on monthly drunk driving citations)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-21-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Noticed how smooth the plot is. The <code>bwidth</code> was set to 2.31, which is constructed using a rule of thumb. It also uses <code>epanechnikov</code> as the default kernel. While you can change the <code>kernel()</code> function, the default one is “optimal” for most cases. What would be more important is the <code>bwidth()</code> option.</p>
</section>
<section id="kernel-densities-and-bandwidth-choice" class="level3">
<h3 class="anchored" data-anchor-id="kernel-densities-and-bandwidth-choice">Kernel Densities and bandwidth choice</h3>
<p>As mentioned before, the bandwidth is a very important parameter. You can set it manually, with the understanding that a smaller bandwidth will make the plot more rugged, and a larger bandwidth will make it smoother. At the limit (infinite bandwidth), the plot will be a horizontal line, and on the other end, it would look like a histogram (each value its own curve)</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" aria-controls="tabset-4-1" aria-selected="true">Smaller Bandwidth</a></li><li class="nav-item"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" aria-controls="tabset-4-2" aria-selected="false">Larger Bandwidth</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" aria-labelledby="tabset-4-1-tab">
<div id="5dafd4f2" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb43-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">webuse</span> dui, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb43-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> citation, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb43-3">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kernel Density Estimate of Citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb43-4">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"# of Citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb43-5">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.5) bw(1)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Fictional data on monthly drunk driving citations)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-22-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" aria-labelledby="tabset-4-2-tab">
<div id="9012add7" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb45-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">webuse</span> dui, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb45-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> citation, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb45-3">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kernel Density Estimate of Citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb45-4">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"# of Citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb45-5">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.5) bw(4)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Fictional data on monthly drunk driving citations)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-23-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Perhaps of interest to some, the Kernel Density does not estimate the bandwidth for every point of data. Instead, it uses a map of points to reduce the computational burden. Then, simply makes a <code>lineplot</code>. If you want to see the curve for every point in your data, you have to use the <code>at()</code> option.</p>
</section>
<section id="curves-areas-and-overlays" class="level3">
<h3 class="anchored" data-anchor-id="curves-areas-and-overlays">Curves, Areas, and Overlays</h3>
<p>Many of the options you can use with histograms, scatterplots or line plots can also be used with Kernel Density plots. However, I will introduce one that some may find useful: <code>recast</code>. This option allows you to change the plot type from a line to something else. For example, you can use <code>recast(area)</code> to fill the area under the curve.</p>
<div id="65a16c22" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb47-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">webuse</span> dui, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb47-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> citation, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb47-3">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kernel Density Estimate of Citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb47-4">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"# of Citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb47-5">  <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.5) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb47-6">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">recast</span>(area) </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Fictional data on monthly drunk driving citations)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-24-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This is not the most effective way of changing the plot type, but does the work if the data is small. With larger datasets, other methods may be more useful.</p>
<p>What about overlaying? We can do that as well, as we did with histograms. Ohh, and in contrast with histograms, you do not need to specify colors, as you did with histograms.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" aria-controls="tabset-5-1" aria-selected="true">Simple Overlap</a></li><li class="nav-item"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" aria-controls="tabset-5-2" aria-selected="false">As an Area</a></li><li class="nav-item"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" aria-controls="tabset-5-3" aria-selected="false">Adding transparency</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" aria-labelledby="tabset-5-1-tab">
<div id="7a322208" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb49-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">global</span> options bw(3)</span>
<span id="cb49-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==1, <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$options</span> ) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb49-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==2, <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$options</span> ) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb49-4">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==3, <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$options</span> ) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb49-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kdensity of citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb49-6">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">subtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"By city Size"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb49-7">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fines in 000$"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb49-8">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Small"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medium"</span> 3 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Large"</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-25-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" aria-labelledby="tabset-5-2-tab">
<div id="44363258" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb50-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">global</span> options bw(3) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">recast</span>(area  )</span>
<span id="cb50-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==1, <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$options</span> ) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb50-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==2, <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$options</span> ) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb50-4">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==3, <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$options</span> ) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb50-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kdensity of citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb50-6">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">subtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"By city Size"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb50-7">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fines in 000$"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb50-8">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Small"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medium"</span> 3 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Large"</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-26-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" aria-labelledby="tabset-5-3-tab">
<div id="42d36e49" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb51-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">global</span> options bw(3) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">recast</span>(area) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(%50)</span>
<span id="cb51-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==1, <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$options</span> ) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb51-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==2, <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$options</span> ) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb51-4">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> citations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> csize==3, <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$options</span> ) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb51-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kdensity of citations"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb51-6">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">subtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"By city Size"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb51-7">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fines in 000$"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb51-8">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Small"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medium"</span> 3 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Large"</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-27-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Few things to notice here.</p>
<ul>
<li>Because im using less data, the default bandwidth makes a rougher plot. I increase it to 3 to make it smoother.</li>
<li>Since the data by groups have “hard” limits, the plots are cut at the edges.</li>
<li>These plot cannot be used to compare the sizes of the groups, as the area under the curve is the same by definition.</li>
</ul>
</section>
</section>
<section id="range-plots" class="level2">
<h2 class="anchored" data-anchor-id="range-plots">Range plots</h2>
<p>There is a fairly large list of plots that fall under this category. Range plots are mostly used to show, as the name implies, a particular range of values. Perhaps the most common of these would be to show confidence intervals.</p>
<p>They all have a similar syntax:</p>
<div class="sourceCode" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb52-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> range_plot y_lower y_higher x_variable [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>] , [options]</span></code></pre></div>
<p>As you can see, the main difference is that you need to specify a lower and upper bound for the y-axis. And, as you can imagine, this will generate a nice rendition of a range.</p>
<p>Perhaps the biggest issue with these plots is that you need to prepare the data beforehand. This is not a big issue.</p>
<p>So lets see how this works:</p>
<section id="ranges-galore" class="level3">
<h3 class="anchored" data-anchor-id="ranges-galore">Ranges Galore</h3>
<p>To show how this type of plots work, I will use the dataset <code>cattaneo2</code>. This dataset contains data for childrens weight at birth, in addition to other relevant information. I will do some data manipulation to create the data I need for the plots</p>
<div id="4a21c2f5" class="cell" data-outcome="false" data-execution_count="28">
<div class="sourceCode cell-code" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb53-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">webuse</span> cattaneo2, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb53-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Constrain age of mother</span></span>
<span id="cb53-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">drop</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mage&lt;18 | mage&gt;35</span>
<span id="cb53-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Get summary for  Weight at birth</span></span>
<span id="cb53-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// mean and p25 and p75 by age and smoking</span></span>
<span id="cb53-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">collapse</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mean</span>) mean_bweight=bweight <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb53-7">         (p25) p25_bweight=bweight <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb53-8">         (p75) p75_bweight=bweight, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">by</span>(mage mbsmoke)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Excerpt from Cattaneo (2010) Journal of Econometrics 155: 138–154)
(488 observations deleted)</code></pre>
</div>
</div>
<p>Now that we have the data, lets create the plot(s). Each one will show the range of weights at birth for different groups of mothers. To add additional information, I will also add the mean “weight at birth” as a scatter plot.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" aria-controls="tabset-6-1" aria-selected="true">Area</a></li><li class="nav-item"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" aria-controls="tabset-6-2" aria-selected="false">Bar</a></li><li class="nav-item"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" aria-controls="tabset-6-3" aria-selected="false">Spike</a></li><li class="nav-item"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" aria-controls="tabset-6-4" aria-selected="false">Cap</a></li><li class="nav-item"><a class="nav-link" id="tabset-6-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-5" aria-controls="tabset-6-5" aria-selected="false">CapSym</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" aria-labelledby="tabset-6-1-tab">
<div id="865631d6" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb55-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (rarea p25_bweight p75_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==0, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(%50)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb55-2">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mean_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==0, pstyle(p1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">connect</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">l</span>)) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb55-3">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Range of Birth Weight by Mother's Age"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb55-4">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mother's Age"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb55-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Birth Weight (lbs)"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb55-6">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.4) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb55-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Note: The shaded area represents the 25th to 75th percentile range"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-29-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" aria-labelledby="tabset-6-2-tab">
<div id="b8d8bb0d" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb56-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (rbar p25_bweight p75_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==0, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(%50)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb56-2">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mean_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==0, pstyle(p1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">connect</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">l</span>)) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb56-3">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Range of Birth Weight by Mother's Age"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb56-4">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mother's Age"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb56-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Birth Weight (lbs)"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb56-6">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.4) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb56-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Note: The shaded area represents the 25th to 75th percentile range"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-30-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" aria-labelledby="tabset-6-3-tab">
<div id="30f2916c" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb57-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (rspike p25_bweight p75_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==0, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(%50)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb57-2">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mean_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==0, pstyle(p1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">connect</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">l</span>)) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb57-3">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Range of Birth Weight by Mother's Age"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb57-4">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mother's Age"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb57-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Birth Weight (lbs)"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb57-6">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.4) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb57-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Note: The shaded area represents the 25th to 75th percentile range"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-31-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-4" class="tab-pane" aria-labelledby="tabset-6-4-tab">
<div id="a3c8d801" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb58-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (rcap p25_bweight p75_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==0, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(%50)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb58-2">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mean_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==0, pstyle(p1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">connect</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">l</span>)) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb58-3">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Range of Birth Weight by Mother's Age"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb58-4">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mother's Age"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb58-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Birth Weight (lbs)"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb58-6">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.4) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb58-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Note: The shaded area represents the 25th to 75th percentile range"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-32-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-5" class="tab-pane" aria-labelledby="tabset-6-5-tab">
<div id="c74a66b8" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb59-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (rcapsym p25_bweight p75_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==0, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(%50)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb59-2">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mean_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==0, pstyle(p1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">connect</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">l</span>)) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb59-3">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Range of Birth Weight by Mother's Age"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb59-4">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mother's Age"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb59-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Birth Weight (lbs)"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb59-6">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.4) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb59-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Note: The shaded area represents the 25th to 75th percentile range"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-33-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>:::</p>
<p>The rest (rscatter, rline and rconnected) are not very useful, as they are just a scatter plot, line plots, or both.</p>
<p>And of course, you can combine them!</p>
<div id="e650436b" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb60-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (rarea p25_bweight p75_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==0, pstyle(p1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(%50)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb60-2">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mean_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==0, pstyle(p1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">connect</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">l</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb60-3">    (rarea p25_bweight p75_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==1, pstyle(p2) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(%50)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb60-4">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> mean_bweight mage <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> mbsmoke==1, pstyle(p2) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">connect</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">l</span>)) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb60-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Range of Birth Weight by Mother's Age"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb60-6">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mother's Age"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb60-7">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Birth Weight (lbs)"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb60-8">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NonSmokers"</span> 3 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Smokers"</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb60-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scale</span>(1.4) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb60-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Note: The shaded area represents the 25th to 75th percentile range"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/stata_08_06_2024/index_files/figure-html/cell-34-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>This are the most basic, yet most useful plots you will use in your data analysis. There are, however, other types of plots that Stata can produce from the box:</p>
<ul>
<li><code>graph pie</code>: Pie charts</li>
<li><code>graph bar</code>: Bar charts, where the bars can be horizontal or vertical, stacked or unstacked, by groups, which can be used to represent many statistical summaries. (The command itself will generate those summaries)</li>
<li><code>graph dot</code>: Dot plots, which are similar to bar charts but use dots instead of bars. Useful to compare summary statistics with a less cluttered plot. Not to be confused with <code>twoway dot</code>.</li>
</ul>
<p>There are also the <code>pair coordinated</code> plots. Where you provide 4 variables, which indicate the initial and final coordinates of a line. So something to keep in mind.</p>
<p>Other than this, there are many community-contributed commands that can be used to create more complex plots, including my own contributions. For for basic data analysis, the above should be more than enough.</p>


<!-- -->

</section>

 ]]></description>
  <category>Stata</category>
  <category>Basics</category>
  <guid>https://friosavila.github.io/chatgpt/stata_08_06_2024/</guid>
  <pubDate>Tue, 06 Aug 2024 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Stata Crash Course: Publication Ready Tables</title>
  <dc:creator>Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/stata_08_04_2024/</link>
  <description><![CDATA[ 





<p>Continuing this quick series of guides with Stata. Something we all need. Tables! Tables are a fundamental part of presenting research results, and there is a community-contributed command that makes it easy to create publication-ready tables in Stata: <code>estout/esttab/estpost</code>. These command come to you thanks to <strong>Ben Jann</strong>. They allow you to generate tables from estimation results, matrices, in a format suitable for publication, including HTML, LaTeX and Markdown.</p>
<p>Of course, for this you need a quick setup:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Install estout package</span></span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ssc</span> install estout</span></code></pre></div>
<section id="summary-statistics" class="level1">
<h1>Summary Statistics</h1>
<p>One of the most common tasks in data analysis is to generate summary statistics. We all know that the easiest way to do this is to use the <code>summarize</code> command. However, making statics tables from the command is not straightforward. However, with <code>estpost</code>, you can easily generate summary statistics tables.</p>
<p>Let’s start with creating a table of summary statistics. For this example, we will use the <code>auto</code> dataset that comes with Stata, and output the tables in markdown format. The output you will see is based on that format.</p>
<div id="c0444480" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Load sample data</span></span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> auto, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Create summary statistics table</span></span>
<span id="cb2-5">estpost <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">summarize</span> price mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span></span>
<span id="cb2-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto summary_stats</span>
<span id="cb2-7">esttab summary_stats <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> summary_stats.txt, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb2-8">    cells(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean(fmt(2)) sd(fmt(2)) min max"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb2-9">    nomtitle nonumber md <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">label</span></span></code></pre></div>
</div>
<div id="tbl-summary-stats" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-summary-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Table 1: Summary Statistics
</figcaption>
<div aria-describedby="tbl-summary-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">mean</th>
<th style="text-align: center;">sd</th>
<th style="text-align: center;">min</th>
<th style="text-align: center;">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Price</td>
<td style="text-align: center;">6165.26</td>
<td style="text-align: center;">2949.50</td>
<td style="text-align: center;">3291.00</td>
<td style="text-align: center;">15906.00</td>
</tr>
<tr class="even">
<td>Mileage (mpg)</td>
<td style="text-align: center;">21.30</td>
<td style="text-align: center;">5.79</td>
<td style="text-align: center;">12.00</td>
<td style="text-align: center;">41.00</td>
</tr>
<tr class="odd">
<td>Weight (lbs.)</td>
<td style="text-align: center;">3019.46</td>
<td style="text-align: center;">777.19</td>
<td style="text-align: center;">1760.00</td>
<td style="text-align: center;">4840.00</td>
</tr>
<tr class="even">
<td>Length (in.)</td>
<td style="text-align: center;">187.93</td>
<td style="text-align: center;">22.27</td>
<td style="text-align: center;">142.00</td>
<td style="text-align: center;">233.00</td>
</tr>
<tr class="odd">
<td>Observations</td>
<td style="text-align: center;">74</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>Data source: Auto dataset</p>
</div>
</figure>
</div>
<p>So how does this work?</p>
<p><code>estpost</code> catches the output of the <code>summarize</code> command and stores into many e() matrices, all part of a new “summary_stats”.</p>
<p>Then <code>esttab</code> formats the content to create a nice table. The <code>cells()</code> option specifies the contents of each table. It should use the “matrices” saved by <code>estpost</code>. The <code>nomtitle</code> option removes the title of the table. The <code>nonumber</code> option removes the row numbers. The <code>md</code> option specifies that the output format is markdown, but other options are possible. The <code>replace</code> option overwrites the file if it already exists. The <code>label</code> option uses variable labels instead of names. Within the <code>cells()</code> option, <code>name(fmt(???))</code> specifies the format of the cell content.</p>
<p>Notice that if “statistic” are specified within quotes, they will be posted side by side. If they are not, they will be posted one below the other.</p>
<section id="advanced-summary-statistics" class="level2">
<h2 class="anchored" data-anchor-id="advanced-summary-statistics">Advanced Summary Statistics</h2>
<p>You can also generate more advanced summary statistics tables, including grouped statistics and custom formatting. Here’s an example:</p>
<div id="1ae60d95" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Load sample data</span></span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">webuse</span> nlsw88, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Calculate summary statistics by occupation category</span></span>
<span id="cb3-5">estpost <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tabstat</span> wage age tenure, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">by</span>(race) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">statistics</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mean</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span> n) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">columns</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">statistics</span>)</span>
<span id="cb3-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto advanced_summary</span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Create advanced summary statistics table</span></span>
<span id="cb3-8">esttab advanced_summary <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> advanced_summary.txt, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb3-9">    cells(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean(fmt(2)) sd(fmt(2)) min(fmt(1)) max(fmt(1)) count(fmt(0))"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb3-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">noobs</span> nonumber nomtitle     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb3-11">    collabels(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Std. Dev."</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Min"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Max"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb3-12">    eqlabels(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"White"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Black"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Other"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb3-13">    varlabels(wage <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;nbsp;&amp;nbsp;Hourly Wage"</span> age <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;nbsp;&amp;nbsp;Age"</span> tenure <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;nbsp;&amp;nbsp;Job Tenure"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb3-14">    alignment(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">r</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">width</span>(20) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb3-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> noline md</span></code></pre></div>
</div>
<div id="tbl-asummary-stats" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-asummary-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Advanced Summary Statistics by Race
</figcaption>
<div aria-describedby="tbl-asummary-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">Mean</th>
<th style="text-align: center;">Std. Dev.</th>
<th style="text-align: center;">Min</th>
<th style="text-align: center;">Max</th>
<th style="text-align: center;">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>White</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>&nbsp;&nbsp;Hourly Wage</td>
<td style="text-align: center;">8.08</td>
<td style="text-align: center;">5.96</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">40.2</td>
<td style="text-align: center;">1637</td>
</tr>
<tr class="odd">
<td>&nbsp;&nbsp;Age</td>
<td style="text-align: center;">39.27</td>
<td style="text-align: center;">3.08</td>
<td style="text-align: center;">34.0</td>
<td style="text-align: center;">46.0</td>
<td style="text-align: center;">1637</td>
</tr>
<tr class="even">
<td>&nbsp;&nbsp;Job Tenure</td>
<td style="text-align: center;">5.81</td>
<td style="text-align: center;">5.46</td>
<td style="text-align: center;">0.0</td>
<td style="text-align: center;">25.9</td>
<td style="text-align: center;">1627</td>
</tr>
<tr class="odd">
<td>Black</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>&nbsp;&nbsp;Hourly Wage</td>
<td style="text-align: center;">6.84</td>
<td style="text-align: center;">5.08</td>
<td style="text-align: center;">1.2</td>
<td style="text-align: center;">40.7</td>
<td style="text-align: center;">583</td>
</tr>
<tr class="odd">
<td>&nbsp;&nbsp;Age</td>
<td style="text-align: center;">38.81</td>
<td style="text-align: center;">2.98</td>
<td style="text-align: center;">34.0</td>
<td style="text-align: center;">45.0</td>
<td style="text-align: center;">583</td>
</tr>
<tr class="even">
<td>&nbsp;&nbsp;Job Tenure</td>
<td style="text-align: center;">6.50</td>
<td style="text-align: center;">5.62</td>
<td style="text-align: center;">0.0</td>
<td style="text-align: center;">24.8</td>
<td style="text-align: center;">578</td>
</tr>
<tr class="odd">
<td>Other</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>&nbsp;&nbsp;Hourly Wage</td>
<td style="text-align: center;">8.55</td>
<td style="text-align: center;">5.21</td>
<td style="text-align: center;">1.8</td>
<td style="text-align: center;">25.8</td>
<td style="text-align: center;">26</td>
</tr>
<tr class="odd">
<td>&nbsp;&nbsp;Age</td>
<td style="text-align: center;">39.31</td>
<td style="text-align: center;">3.25</td>
<td style="text-align: center;">34.0</td>
<td style="text-align: center;">44.0</td>
<td style="text-align: center;">26</td>
</tr>
<tr class="even">
<td>&nbsp;&nbsp;Job Tenure</td>
<td style="text-align: center;">4.95</td>
<td style="text-align: center;">5.24</td>
<td style="text-align: center;">0.2</td>
<td style="text-align: center;">21.2</td>
<td style="text-align: center;">26</td>
</tr>
<tr class="odd">
<td>Total</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>&nbsp;&nbsp;Hourly Wage</td>
<td style="text-align: center;">7.77</td>
<td style="text-align: center;">5.76</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">40.7</td>
<td style="text-align: center;">2246</td>
</tr>
<tr class="odd">
<td>&nbsp;&nbsp;Age</td>
<td style="text-align: center;">39.15</td>
<td style="text-align: center;">3.06</td>
<td style="text-align: center;">34.0</td>
<td style="text-align: center;">46.0</td>
<td style="text-align: center;">2246</td>
</tr>
<tr class="even">
<td>&nbsp;&nbsp;Job Tenure</td>
<td style="text-align: center;">5.98</td>
<td style="text-align: center;">5.51</td>
<td style="text-align: center;">0.0</td>
<td style="text-align: center;">25.9</td>
<td style="text-align: center;">2231</td>
</tr>
</tbody>
</table>
<p>Data source: NLSW 1988</p>
</div>
</figure>
</div>
<p>In this example, notice that I use varlabels to provide custom labels for the variables. Because I want to use markdown for the output, I use <code>&amp;nbsp;</code> to add spaces, and add some hierarchy on the tables. I also use eqlabels to provide custom labels for the equation names (in this case, race categories). The alignment(r) option right-aligns all cells, althought it does not have an effect on md. The noline option removes the horizontal lines between rows.</p>
</section>
<section id="regression-table" class="level2">
<h2 class="anchored" data-anchor-id="regression-table">Regression Table</h2>
<p>Next is the most common excercise we would do in Stata: regression analysis. Here’s how you can create a table with regression results:</p>
<div id="dfcc4c92" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Load sample data</span></span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> auto, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb4-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">regress</span> price <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span> mpg</span>
<span id="cb4-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">estimates</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">store</span> model1</span>
<span id="cb4-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">regress</span> price <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span> mpg foreign</span>
<span id="cb4-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">estimates</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">store</span> model2</span>
<span id="cb4-7"></span>
<span id="cb4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Create regression table</span></span>
<span id="cb4-9">esttab model1 model2 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> regression_results.txt, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb4-10">    b(3) se(3) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">star</span>(* 0.10 ** 0.05 *** 0.01) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb4-11">    r2 ar2 nonumber <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) noline md <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb4-12">    mtitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model 1"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model 2"</span>)</span></code></pre></div>
</div>
<div id="tbl-regression" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Regression Results
</figcaption>
<div aria-describedby="tbl-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">Model 1</th>
<th style="text-align: center;">Model 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>weight</td>
<td style="text-align: center;">1.747***</td>
<td style="text-align: center;">3.465***</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: center;">(0.641)</td>
<td style="text-align: center;">(0.631)</td>
</tr>
<tr class="odd">
<td>mpg</td>
<td style="text-align: center;">-49.512</td>
<td style="text-align: center;">21.854</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: center;">(86.156)</td>
<td style="text-align: center;">(74.221)</td>
</tr>
<tr class="odd">
<td>foreign</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">3673.060***</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(683.978)</td>
</tr>
<tr class="odd">
<td>_cons</td>
<td style="text-align: center;">1946.069</td>
<td style="text-align: center;">-5853.696*</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: center;">(3597.050)</td>
<td style="text-align: center;">(3376.987)</td>
</tr>
<tr class="odd">
<td><em>N</em></td>
<td style="text-align: center;">74</td>
<td style="text-align: center;">74</td>
</tr>
<tr class="even">
<td><em>R</em><sup>2</sup></td>
<td style="text-align: center;">0.293</td>
<td style="text-align: center;">0.500</td>
</tr>
<tr class="odd">
<td>adj. <em>R</em><sup>2</sup></td>
<td style="text-align: center;">0.273</td>
<td style="text-align: center;">0.478</td>
</tr>
</tbody>
</table>
<p><br> * <em>p</em> &lt; 0.10, ** <em>p</em> &lt; 0.05, *** <em>p</em> &lt; 0.01</p>
<p>Data source: Auto, Standard errors in parentheses, * p&lt;0.10, ** p&lt;0.05, *** p&lt;0.01</p>
</div>
</figure>
</div>
<p>This code is more straight forward. After the regressions are estimated, and stored with <code>est sto</code>, the <code>esttab</code> command is used to create the table. The <code>b(3)</code> and <code>se(3)</code> options specify that the coefficients and standard errors should be displayed with 3 decimal places. The <code>star()</code> option specifies the significance levels for the stars. The <code>r2 ar2</code> options include the R-squared and adjusted R-squared statistics. The <code>nonumber</code> option removes the row numbers. This is necessary for <code>markdown</code> tables, because markdown only allows for a single title row.</p>
</section>
<section id="correlation-matrix" class="level2">
<h2 class="anchored" data-anchor-id="correlation-matrix">Correlation Matrix</h2>
<p>Correlation matrices are also common in data analysis. They are easy enough to create with <code>correlate</code>. Making them into a table can also be easy:</p>
<div id="bbee2e27" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Generate correlation matrix</span></span>
<span id="cb5-2">estpost correlate price mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span></span>
<span id="cb5-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto corr_matrix</span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Create correlation table</span></span>
<span id="cb5-5">esttab corr_matrix <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> correlation_matrix.txt, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb5-6">    cell(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rho(fmt(3))"</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> nonumber collabels(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">none</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb5-7">    nomtitle noline unstack <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">label</span> md</span></code></pre></div>
</div>
<div id="tbl-corr" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Correlation matrix
</figcaption>
<div aria-describedby="tbl-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Mileage (mpg)</th>
<th style="text-align: center;">Weight (lbs.)</th>
<th style="text-align: center;">Length (in.)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Price</td>
<td style="text-align: center;">1.000</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>Mileage (mpg)</td>
<td style="text-align: center;">-0.469</td>
<td style="text-align: center;">1.000</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>Weight (lbs.)</td>
<td style="text-align: center;">0.539</td>
<td style="text-align: center;">-0.807</td>
<td style="text-align: center;">1.000</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>Length (in.)</td>
<td style="text-align: center;">0.432</td>
<td style="text-align: center;">-0.796</td>
<td style="text-align: center;">0.946</td>
<td style="text-align: center;">1.000</td>
</tr>
<tr class="odd">
<td>Observations</td>
<td style="text-align: center;">74</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>Data source: Auto</p>
</div>
</figure>
</div>
<p>This creates a correlation matrix with formatted coefficients. In contrast with <code>correlate</code>, if using <code>estatpost</code>, its necessary to also use the option <code>matrix</code>.</p>
<p>In case of <code>esttab</code>, it is necessary to use <code>unstuck</code>. But other than that, obtaining the tables is quite straightforward.</p>
</section>
<section id="regressions-with-fixed-effects" class="level2">
<h2 class="anchored" data-anchor-id="regressions-with-fixed-effects">Regressions with Fixed Effects</h2>
<p>Now something that is very common in regression analysis: fixed effects models. A usual question is how to create tables that signal the inclusion of fixed effects. Here’s an example:</p>
<div id="088d37d4" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Load panel data and set as panel</span></span>
<span id="cb6-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">webuse</span> nlswork, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb6-3">xtset idcode <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// ssc install reghdfe</span></span>
<span id="cb6-5"></span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Run regressions</span></span>
<span id="cb6-7">reghdfe ln_wage tenure c.age##c.age </span>
<span id="cb6-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto no_fe</span>
<span id="cb6-9"></span>
<span id="cb6-10">reghdfe ln_wage tenure c.age##c.age , absorb(idcode)</span>
<span id="cb6-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto id_fe</span>
<span id="cb6-12">estadd <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> id_fe <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span></span>
<span id="cb6-13"></span>
<span id="cb6-14">reghdfe ln_wage tenure c.age##c.age , absorb(idcode <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>)</span>
<span id="cb6-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto idyr_fe</span>
<span id="cb6-16">estadd <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> id_fe <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span></span>
<span id="cb6-17">estadd <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> yr_fe <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span></span>
<span id="cb6-18"></span>
<span id="cb6-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Create table</span></span>
<span id="cb6-20"> </span>
<span id="cb6-21">esttab no_fe  id_fe idyr_fe <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> mreg.txt, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb6-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scalar</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id_fe Individual FE"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yr_fe Yr FE"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb6-23">noline  md  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">nonotes</span> nomtitle  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span></span></code></pre></div>
</div>
<div id="tbl-corr" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Regression Results with FE
</figcaption>
<div aria-describedby="tbl-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 29%">
<col style="width: 29%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">(1)</th>
<th style="text-align: center;">(2)</th>
<th style="text-align: center;">(3)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>tenure</td>
<td style="text-align: center;">0.0391<sup>***</sup></td>
<td style="text-align: center;">0.0217<sup>***</sup></td>
<td style="text-align: center;">0.0214<sup>***</sup></td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: center;">(50.48)</td>
<td style="text-align: center;">(27.21)</td>
<td style="text-align: center;">(26.88)</td>
</tr>
<tr class="odd">
<td>age</td>
<td style="text-align: center;">0.0752<sup>***</sup></td>
<td style="text-align: center;">0.0523<sup>***</sup></td>
<td style="text-align: center;">0.0750<sup>***</sup></td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: center;">(21.65)</td>
<td style="text-align: center;">(18.78)</td>
<td style="text-align: center;">(7.03)</td>
</tr>
<tr class="odd">
<td>c.age#c.age</td>
<td style="text-align: center;">-0.00109<sup>***</sup></td>
<td style="text-align: center;">-0.000672<sup>***</sup></td>
<td style="text-align: center;">-0.00107<sup>***</sup></td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: center;">(-18.86)</td>
<td style="text-align: center;">(-14.56)</td>
<td style="text-align: center;">(-17.74)</td>
</tr>
<tr class="odd">
<td>_cons</td>
<td style="text-align: center;">0.334<sup>***</sup></td>
<td style="text-align: center;">0.688<sup>***</sup></td>
<td style="text-align: center;">0.384</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: center;">(6.62)</td>
<td style="text-align: center;">(16.95)</td>
<td style="text-align: center;">(1.29)</td>
</tr>
<tr class="odd">
<td><em>N</em></td>
<td style="text-align: center;">28101</td>
<td style="text-align: center;">27549</td>
<td style="text-align: center;">27549</td>
</tr>
<tr class="even">
<td>Individual FE</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
</tr>
<tr class="odd">
<td>Yr FE</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
</tr>
</tbody>
</table>
<p>Data source: NLSW 1988, <sup>*</sup> <em>p</em> &lt; 0.05, <sup>**</sup> <em>p</em> &lt; 0.01, <sup>***</sup> <em>p</em> &lt; 0.001</p>
</div>
</figure>
</div>
<p>This example shows how to use <code>estadd</code> to include additional information to a regression. This information can be later used in the table. In this case, the fixed effects are included in the table. The <code>scalar</code> option is used to include the extra information.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>I think these are the most basic tables you can create with <code>esttab</code>. There are many more options available, and you can customize the tables to your needs. Using Quarto, something I am doing more often, is to create the tables in Stata, modify the latex code, and then include them in the final document. This is a great way to create reproducible research.</p>


<!-- -->

</section>
</section>

 ]]></description>
  <category>Stata</category>
  <category>Basics</category>
  <guid>https://friosavila.github.io/chatgpt/stata_08_04_2024/</guid>
  <pubDate>Sun, 04 Aug 2024 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Stata Crash Course: Data management</title>
  <dc:creator>Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/stata_08_02_2024/</link>
  <description><![CDATA[ 





<p>As you know, my weapon of choice for data analysis is Stata. However, even with my experience, I still find myself going back to the basics, especially when it comes to guiding students through their projects.</p>
<p>So, today, I wanted to take a moment to go over some of the fundamental aspects of data management in Stata, covering some of the fundamental toos on working with data. Even if you’re already familiar with Stata, a refresher never hurts!</p>
<section id="basic-data-operations" class="level1">
<h1>Basic Data Operations</h1>
<ul>
<li>Loading data: <code>use filename.dta</code></li>
</ul>
<p>Assumes there is either no data in memory, or the one in memory has not been modified since it was loaded.</p>
<p>Otherwise, you should start with <code>clear</code> to remove the existing data from memory. <code>clear, all</code> to remove data and programs from memory, or just add the option <code>,clear</code> to the <code>use</code> command, to clear the data before loading the new one.</p>
<ul>
<li>Saving data: <code>save filename.dta, replace</code></li>
</ul>
<p>This will always overwrite the existing file. If you want to save a new file, just change the name. If <code>replace</code> is omitted, Stata will ask for confirmation.</p>
<p>You can also use <code>saveold</code> to save the data in the old format (Stata 11 is the oldest if you have Stata 18).</p>
<p>Remember, never replace the original data.</p>
<ul>
<li>Viewing data:
<ul>
<li><code>browse</code>: opens data browser window, no changes can be made</li>
<li><code>edit</code>: Like <code>browse</code>, but allows changes to be made to the data. Use with caution! Each change appears as a new line of command in the command/results window.</li>
<li><code>list</code>: displays data in results window. You may want to specify variables or conditions.</li>
</ul></li>
<li>Describing data:
<ul>
<li><code>describe</code>: shows variable names, labels, and types. Also shows other information from the data.</li>
<li><code>summarize</code>: provides summary statistics for numerical variables. You can also use <code>summarize, detail</code> for more detailed statistics.</li>
</ul></li>
</ul>
<p>Example:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto.dta"</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">describe</span></span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">summarize</span> price mpg, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">detail</span></span>
<span id="cb1-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">save</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my_autho.dta"</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span></span></code></pre></div>
</section>
<section id="variable-types-in-stata" class="level1">
<h1>Variable Types in Stata</h1>
<ul>
<li>Numeric:
<ul>
<li><code>byte</code>: integers -127 to 100</li>
<li><code>int</code>: integers -32,767 to 32,740</li>
<li><code>long</code>: integers -2,147,483,647 to 2,147,483,620</li>
<li><code>float</code>: real numbers with 7 digits precision</li>
<li><code>double</code>: real numbers with 16 digits precision</li>
</ul></li>
</ul>
<p>If trying to save memory, use the smallest type that can hold the data. But if the data cannot be held, Stata will try to upgrade the type (later versions)</p>
<ul>
<li>String: <code>str#</code> (# is the maximum length)</li>
</ul>
<p>Best way to store really long ID variables. But use the most space.</p>
<ul>
<li>Date and time:
<ul>
<li><code>date</code>: dates since 1960</li>
<li><code>time</code>: milliseconds since midnight</li>
</ul></li>
</ul>
<p>These are not data formats, but masks for the data. summarize a date, and you will see.</p>
<p>Example:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">generate</span> age_group = <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">int</span>(age/10)</span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">generate</span> <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"John Doe"</span></span>
<span id="cb2-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">generate</span> survey_date = <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdy</span>(6, 15, 2023)</span>
<span id="cb2-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">format</span> %td survey_date</span></code></pre></div>
<section id="creating-new-variables" class="level2">
<h2 class="anchored" data-anchor-id="creating-new-variables">Creating New Variables</h2>
<ul>
<li><p><code>generate</code> : This is the most basic way to create new variables in Stata. All transformations are done observation by observation.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">generate</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">type</span>] new_var = expression [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span>]</span></code></pre></div></li>
<li><p>Examples:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">generate</span> bmi = <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span> / (height/100)^2</span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">generate</span> log_income = <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(income)</span>
<span id="cb4-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">generate</span> is_adult = (age &gt;= 18)</span></code></pre></div></li>
<li><p>Using functions:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">generate</span> fullname = <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strproper</span>(firstname + <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span> + lastname)</span>
<span id="cb5-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">generate</span> age_squared = age^2</span></code></pre></div></li>
</ul>
</section>
<section id="modifying-existing-variables" class="level2">
<h2 class="anchored" data-anchor-id="modifying-existing-variables">Modifying Existing Variables</h2>
<ul>
<li><p><code>replace</code> : Second most common command in Stata. Works like <code>generate</code>, but it modifies existing variables:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> = expression [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> condition]</span></code></pre></div></li>
<li><p>Examples:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> income = income * 1.1 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span> == 2023</span>
<span id="cb7-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> age = . <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> age &lt; 0  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Set negative ages to missing</span></span>
<span id="cb7-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> education = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"High School"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inlist</span>(education, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HS"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Secondary"</span>)</span></code></pre></div></li>
</ul>
</section>
<section id="more-on-generating-variables-egen" class="level2">
<h2 class="anchored" data-anchor-id="more-on-generating-variables-egen">More on generating variables: <code>egen</code></h2>
<ul>
<li><p><code>egen</code> : This is a powerful command that allows you to generate new variables based on complex conditions by observations or across groups. You can even develop your own functions to use with <code>egen</code>. <code>egen</code> can work using information across observations, like the mean of a variable. Useful to have <code>ssc install egenmore</code> installed.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> new_var = <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">varlist</span>) [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> condition], [options]</span></code></pre></div>
<p><code>egen</code> can also have their own options.</p></li>
<li><p>Examples:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> mean_income = <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mean</span>(income)</span>
<span id="cb9-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> total_sales = <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">total</span>(sales)</span>
<span id="cb9-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> max_age = <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(age)</span>
<span id="cb9-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> group_mean_income = <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mean</span>(income), <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">by</span>(group_var)</span></code></pre></div></li>
</ul>
</section>
<section id="recoding-variables" class="level2">
<h2 class="anchored" data-anchor-id="recoding-variables">Recoding Variables</h2>
<ul>
<li><p><code>recode</code> : Useful for transforming values into categories or changing values in categorical variables. The <em>rules</em> can include ranges, individual values, or missing values, as well as value labels.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">recode</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>) (rule) (rule) ..., <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">generate</span>(new_var)</span></code></pre></div></li>
<li><p>Examples:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb11-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">recode</span> age (0/18=1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Child"</span>) (19/65=2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>) (66/<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>=3 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Senior"</span>), <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span>(age_group)</span>
<span id="cb11-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">recode</span> income (0/1000=1) (1001/5000=2) (5001/<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>=3), <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span>(income_category)</span></code></pre></div></li>
<li><p><code>encode</code> : Useful for converting string variables to numeric codes. It creates a new <strong>numeric</strong> variable that represents the original string variable, which is used as labels. The values are assigned in alphabetical order.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb12-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">encode</span> str_var, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span>(num_var)</span></code></pre></div></li>
<li><p><code>decode</code> : The reverse of <code>encode</code>. It replaces the numeric codes with the label values.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb13-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">decode</span> str_var, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span>(num_var)</span></code></pre></div></li>
</ul>
</section>
<section id="conditional-statements" class="level2">
<h2 class="anchored" data-anchor-id="conditional-statements">Conditional Statements</h2>
<ul>
<li><p><code>if</code> condition: Most commands in Stata allow you to specify conditions on the data to be analyzed or modified.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb14-1">command ... <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> expression</span></code></pre></div>
<p>Examples:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb15-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">summarize</span> income <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> gender == <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Female"</span></span>
<span id="cb15-2"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">list</span> <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> age <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> age &gt; 65 &amp; !<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">missing</span>(income)</span></code></pre></div>
<p><strong>Warning</strong>: When comparing numbers with missing values, remember that “missing” is always the highest value.</p></li>
<li><p>Using logical operators:</p>
<ul>
<li><code>&amp;</code> (and), <code>|</code> (or), <code>!</code> (not) They can be combined to create complex conditions. Parentheses can be used to control the order of operations.</li>
</ul>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb16-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">generate</span> high_income_male = (income &gt; 100000) &amp; (gender == <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Male"</span>)</span></code></pre></div></li>
</ul>
</section>
<section id="labeling-variables-and-values" class="level2">
<h2 class="anchored" data-anchor-id="labeling-variables-and-values">Labeling Variables and Values</h2>
<ul>
<li><p>Variable labels: Best way to provide a description of the variable.</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb17-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">label</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">variable</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span></span></code></pre></div>
<p>Labels have a maximum length of 80 characters. If you need more, consider using notes.</p></li>
<li><p>Value labels:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb18-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">label</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">define</span> label_name #1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label1"</span> #2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label2"</span> ... [, modify]</span>
<span id="cb18-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">label</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">values</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> label_name</span></code></pre></div>
<p>Once a label is defined, it can be applied to multiple variables. The <code>modify</code> option allows you to add new labels to an existing set, or modify existing ones.</p></li>
<li><p>Examples:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb19-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">label</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">variable</span> bmi <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Body Mass Index"</span></span>
<span id="cb19-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">label</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">define</span> bmi_cat 1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Underweight"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normal"</span> 3 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Overweight"</span> 4 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Obese"</span></span>
<span id="cb19-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">label</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">values</span> bmi bmi_cat</span></code></pre></div></li>
<li><p>Checking labels:</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb20-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">label</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">list</span></span></code></pre></div></li>
</ul>
</section>
<section id="working-with-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="working-with-missing-values">Working with Missing Values</h2>
<ul>
<li><p>Stata’s missing value for numerical variables: <code>.</code></p></li>
<li><p>Extended missing values: <code>.a</code> to <code>.z</code></p></li>
<li><p>Remember <code>.&gt;.z&gt;...&gt;.a&gt;any number</code></p></li>
<li><p>Identifying missing values:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb21-1"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">list</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">missing</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span>)</span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">missing</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span>)</span></code></pre></div></li>
<li><p>Recoding missing values:</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb22-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> = 0 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">missing</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span>)</span></code></pre></div></li>
</ul>
</section>
<section id="renaming-variables" class="level2">
<h2 class="anchored" data-anchor-id="renaming-variables">Renaming Variables</h2>
<ul>
<li><p><code>rename</code> : To change the name of a variable. You can rename multiple variables at once.</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb23-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">rename</span> old_name new_name</span></code></pre></div></li>
<li><p>Examples:</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb24-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">rename</span> income annual_income</span>
<span id="cb24-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">rename</span> (var1 var2 var3) (new1 new2 new3)</span></code></pre></div></li>
</ul>
</section>
<section id="reshaping-data" class="level2">
<h2 class="anchored" data-anchor-id="reshaping-data">Reshaping Data</h2>
<p>Also known as pivoting data. It involves changing the structure of the data from wide to long or vice versa.</p>
<ul>
<li><p>Wide to Long:</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb25-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reshape</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">long</span> stub, i(id) j(time)</span></code></pre></div>
<p><code>stub</code> is the common prefix of the variables to be reshaped. and <code>time</code> the new variable name that will hold the sufix of the variables. <code>id</code> is the identifier of the observations.</p></li>
<li><p>Long to Wide: The same as before, but the data is reshaped in the opposite direction.</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb26-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reshape</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">wide</span> stub, i(id) j(time)</span></code></pre></div>
<p><code>stub</code> is the variable that will be reshaped. Data should be uniquely identified by the <code>i()</code> and <code>j()</code> variables. The values of <code>j()</code> will be used to create the new variable names combining the stub.</p></li>
</ul>
</section>
<section id="merging-datasets" class="level2">
<h2 class="anchored" data-anchor-id="merging-datasets">Merging Datasets</h2>
<p>Useful to work with relational data. You can merge datasets based on common variables (keys).</p>
<p>When using merge, the <strong>master dataset</strong> is the one currently in memory, and the <strong>using dataset</strong> is the one being added.</p>
<p>There are different types of merges:</p>
<ul>
<li><p>One-to-one merge:</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb27-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> 1:1 key <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> filename</span></code></pre></div></li>
<li><p>Many-to-one merge:</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb28-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">m</span>:1 key <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> filename</span></code></pre></div></li>
<li><p>One-to-many merge:</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb29-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> 1:<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">m</span> key <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> filename</span></code></pre></div>
<p>They key is the variable that is common to both datasets, and it should be unique in the “1” dataset. Master (1:1 and 1:m) or using (1:1 and m:1) datasets.</p></li>
<li><p>Example:</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb30-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> 1:1 id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> employee_details.dta</span>
<span id="cb30-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">m</span>:1 state <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> state_info.dta</span></code></pre></div></li>
<li><p>Handling merge results: Unless specified, Stata will create a new variable <code>_merge</code> to indicate the merge status. If one exists in the master or using dataset, the merge will fail.</p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb31-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">drop</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_merge</span> == 2  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Drop unmatched from using</span></span></code></pre></div></li>
</ul>
</section>
<section id="appending-datasets" class="level2">
<h2 class="anchored" data-anchor-id="appending-datasets">Appending Datasets</h2>
<ul>
<li><p>Adding observations: Useful when you have multiple datasets with the same structure and want to combine them, in the long way.</p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb32-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">append</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> filename</span></code></pre></div></li>
</ul>
<p>In older versions, you needed to have a dataset already open in memory. Now, you can append without a dataset in memory.</p>
<ul>
<li><p>Example:</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb33-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> survey2022.dta</span>
<span id="cb33-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">append</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> survey2023.dta</span></code></pre></div>
<p>Make sure the variables are of the same type. (String and numeric do not mix)</p></li>
</ul>
</section>
<section id="sorting-data" class="level2">
<h2 class="anchored" data-anchor-id="sorting-data">Sorting Data</h2>
<ul>
<li><p><code>sort</code> : Some commands or procedures require the data to be sorted in a specific order. You can sort by multiple variables.</p>
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb34-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span> var1 [var2 ...]</span></code></pre></div>
<p>When there are ties, Stata will sort records randomly, unless <code>stable</code> is specified.</p></li>
<li><p><code>gsort</code> is a variant of <code>sort</code> that can sort in ascending or descending order.</p>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb35-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gsort</span> -<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Sort in descending order</span></span></code></pre></div></li>
<li><p>Example:</p>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb36-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span> state <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span></span>
<span id="cb36-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gsort</span> -income  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Sort in descending order</span></span></code></pre></div></li>
<li><p>Creating a sorted index:</p>
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb37-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span> state <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span></span>
<span id="cb37-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">index</span> = <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_n</span></span></code></pre></div></li>
</ul>
</section>
<section id="creating-complex-variables-with-by-and-bysort" class="level2">
<h2 class="anchored" data-anchor-id="creating-complex-variables-with-by-and-bysort">Creating Complex Variables with <code>by</code> and <code>bysort</code></h2>
<ul>
<li><p><code>by</code> command: Only works if data is already sorted. Operations are performed within groups defined by the variable(s) specified.</p>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb38-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">by</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">varlist</span>: command</span></code></pre></div></li>
<li><p><code>bysort</code> command (combines sorting and by):</p>
<div class="sourceCode" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb39-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">bysort</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">varlist</span>: command</span></code></pre></div></li>
<li><p>Examples:</p>
<ol type="1">
<li><p>Calculate group means:</p>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb40-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">bysort</span> state: <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> state_avg_income = <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mean</span>(income)</span>
<span id="cb40-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> state_avg_income = <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mean</span>(income), <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">by</span>(state)</span></code></pre></div></li>
<li><p>Create ranking within groups:</p>
<div class="sourceCode" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb41-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">bysort</span> industry: <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> income_rank = <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rank</span>(income)</span></code></pre></div></li>
<li><p>Generate group-specific indicators:</p>
<div class="sourceCode" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb42-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">bysort</span> state: <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> state_obs = <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_n</span></span>
<span id="cb42-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">bysort</span> state: <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> state_total_obs = _N</span></code></pre></div></li>
<li><p>Create cumulative sums within groups:</p>
<div class="sourceCode" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb43-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span> state <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">date</span></span>
<span id="cb43-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">by</span> state: <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> cumulative_sales = <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sum</span>(daily_sales)</span></code></pre></div></li>
<li><p>Identify first and last observations in each group:</p>
<div class="sourceCode" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb44-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">bysort</span> company_id (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">date</span>): <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> first_obs = <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_n</span> == 1</span>
<span id="cb44-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">bysort</span> company_id (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">date</span>): <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> last_obs = <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_n</span> == _N</span></code></pre></div></li>
</ol></li>
</ul>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Data management is a crucial part at the beginning of any data analysis project. Hopefully, this list of commands and examples will help you navigate your data more efficiently.</p>


<!-- -->

</section>

 ]]></description>
  <category>Stata</category>
  <category>Basics</category>
  <guid>https://friosavila.github.io/chatgpt/stata_08_02_2024/</guid>
  <pubDate>Fri, 02 Aug 2024 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Quarto 1.4</title>
  <dc:creator>Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/quar_01_25_2024/</link>
  <description><![CDATA[ 





<p>Quarto 1.4 is out! Over the last few weeks, they have been pushing quite few updates, and finally they have released version 1.4.</p>
<p>What is quite interesting to me is that this version includes a new feature that I have been waiting for a while: Multi source cross-referencing!</p>
<p>I have been using Quarto for some time now, and one of the things I noticed is that it was very easy to add titles and cross-references to tables as long as they were formated as markdown tables.</p>
<p>However, as you may now, markdown tables are not very flexible. Better options include HTML tables, and even better, LaTeX tables. Unfortunately, there was no easy way to reference those kinds of tables using the <code>@ref</code> syntax. Looking at other people’s questions and solutions, they all seemed a bit complicated to me. (specially those that involved using LaTeX commands).</p>
<p>But now, with version 1.4, it seems very easy to reference tables that are not markdown tables!</p>
<p>Let’s see how it works!</p>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>To do this, I will produce a simple regression using <code>Stata</code>, and export it as markdown, HTML, and LaTeX tables using <code>esttab</code><sup>1</sup>.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1">*| code-fold: false</span>
<span id="cb1-2">*| echo: true</span>
<span id="cb1-3">frause oaxaca, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb1-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reg</span>  lnwage educ exper tenure female</span>
<span id="cb1-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto m1</span>
<span id="cb1-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reg</span>  lnwage educ exper tenure female age agesq married divorced</span>
<span id="cb1-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto m2</span>
<span id="cb1-8"></span>
<span id="cb1-9">esttab m1 m2 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reg_md"</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">wide</span> se <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> md</span>
<span id="cb1-10">esttab m1 m2 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reg_html"</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">wide</span> se <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> htm</span>
<span id="cb1-11">esttab m1 m2 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reg_tex"</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">wide</span> se <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> tex</span></code></pre></div>
<p>The output of the code is not usable right away, as it has some minor issues. For example, the markdown table has an extra line that needs to be removed.</p>
</section>
<section id="markdown-table" class="level2">
<h2 class="anchored" data-anchor-id="markdown-table">Markdown table</h2>
<p>For the next I will make it simple, using what I think is the easiest cross reference the tables:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1">::: {#tbl-table1}</span>
<span id="cb2-2">{{&lt; include reg_md.md &gt;}}</span>
<span id="cb2-3">Table made with markdown</span>
<span id="cb2-4">:::</span></code></pre></div>
<p>General syntax:</p>
<ul>
<li>line 1 indicates we will be creating table that could be referenced using <code>@tbl-table1</code> code.</li>
<li>line 2 request to “include” the markdown table file.</li>
<li>line 3 is the title of this table</li>
</ul>
<p>The result is the following table:</p>
<div id="tbl-table1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-table1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Table made with markdown
</figcaption>
<div aria-describedby="tbl-table1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 30%">
<col style="width: 12%">
<col style="width: 30%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">(1)</th>
<th style="text-align: center;"></th>
<th style="text-align: center;">(2)</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>educ</td>
<td style="text-align: center;">0.0848<sup>***</sup></td>
<td style="text-align: center;">(0.00519)</td>
<td style="text-align: center;">0.0644<sup>***</sup></td>
<td style="text-align: center;">(0.00508)</td>
</tr>
<tr class="even">
<td>exper</td>
<td style="text-align: center;">0.0111<sup>***</sup></td>
<td style="text-align: center;">(0.00154)</td>
<td style="text-align: center;">-0.000311</td>
<td style="text-align: center;">(0.00181)</td>
</tr>
<tr class="odd">
<td>tenure</td>
<td style="text-align: center;">0.00771<sup>***</sup></td>
<td style="text-align: center;">(0.00188)</td>
<td style="text-align: center;">0.00672<sup>***</sup></td>
<td style="text-align: center;">(0.00190)</td>
</tr>
<tr class="even">
<td>female</td>
<td style="text-align: center;">-0.0841<sup>***</sup></td>
<td style="text-align: center;">(0.0251)</td>
<td style="text-align: center;">-0.160<sup>***</sup></td>
<td style="text-align: center;">(0.0243)</td>
</tr>
<tr class="odd">
<td>age</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.113<sup>***</sup></td>
<td style="text-align: center;">(0.00814)</td>
</tr>
<tr class="even">
<td>agesq</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">-0.00126<sup>***</sup></td>
<td style="text-align: center;">(0.0000976)</td>
</tr>
<tr class="odd">
<td>married</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">-0.0224</td>
<td style="text-align: center;">(0.0294)</td>
</tr>
<tr class="even">
<td>divorced</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.0719</td>
<td style="text-align: center;">(0.0412)</td>
</tr>
<tr class="odd">
<td>_cons</td>
<td style="text-align: center;">2.213<sup>***</sup></td>
<td style="text-align: center;">(0.0683)</td>
<td style="text-align: center;">0.311<sup>*</sup></td>
<td style="text-align: center;">(0.149)</td>
</tr>
<tr class="even">
<td><em>N</em></td>
<td style="text-align: center;">1434</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1434</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>Standard errors in parentheses<br> <sup>*</sup> <em>p</em> &lt; 0.05, <sup>**</sup> <em>p</em> &lt; 0.01, <sup>***</sup> <em>p</em> &lt; 0.001</p>
</div>
</figure>
</div>
<p>This one was already feasible before however.</p>
</section>
<section id="html-table" class="level2">
<h2 class="anchored" data-anchor-id="html-table">HTML table</h2>
<p>Now, let’s try with an HTML table. The syntax is very similar:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ::: {#tbl-table2}</span></span>
<span id="cb3-2"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ````{=html}</span></span>
<span id="cb3-3"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    {{&lt; include reg_html.html &gt;}}</span></span>
<span id="cb3-4"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ````</span></span>
<span id="cb3-5"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Table made with markdown</span></span>
<span id="cb3-6"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    :::</span></span></code></pre></div>
<p>with the following result:</p>
<div id="tbl-table2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-table2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Table made with HTML
</figcaption>
<div aria-describedby="tbl-table2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table" data-quarto-postprocess="true" data-border="0" width="*">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>(1)</th>
<th></th>
<th>(2)</th>
<th></th>
</tr>
<tr class="odd">
<th></th>
<th>lnwage</th>
<th></th>
<th>lnwage</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>educ</td>
<td>0.0848<sup>***</sup></td>
<td>(0.00519)</td>
<td>0.0644<sup>***</sup></td>
<td>(0.00508)</td>
</tr>
<tr class="even">
<td>exper</td>
<td>0.0111<sup>***</sup></td>
<td>(0.00154)</td>
<td>-0.000311</td>
<td>(0.00181)</td>
</tr>
<tr class="odd">
<td>tenure</td>
<td>0.00771<sup>***</sup></td>
<td>(0.00188)</td>
<td>0.00672<sup>***</sup></td>
<td>(0.00190)</td>
</tr>
<tr class="even">
<td>female</td>
<td>-0.0841<sup>***</sup></td>
<td>(0.0251)</td>
<td>-0.160<sup>***</sup></td>
<td>(0.0243)</td>
</tr>
<tr class="odd">
<td>age</td>
<td></td>
<td></td>
<td>0.113<sup>***</sup></td>
<td>(0.00814)</td>
</tr>
<tr class="even">
<td>agesq</td>
<td></td>
<td></td>
<td>-0.00126<sup>***</sup></td>
<td>(0.0000976)</td>
</tr>
<tr class="odd">
<td>married</td>
<td></td>
<td></td>
<td>-0.0224</td>
<td>(0.0294)</td>
</tr>
<tr class="even">
<td>divorced</td>
<td></td>
<td></td>
<td>0.0719</td>
<td>(0.0412)</td>
</tr>
<tr class="odd">
<td>_cons</td>
<td>2.213<sup>***</sup></td>
<td>(0.0683)</td>
<td>0.311<sup>*</sup></td>
<td>(0.149)</td>
</tr>
</tbody>
<tbody>
<tr class="odd">
<td><em>N</em></td>
<td>1434</td>
<td></td>
<td>1434</td>
<td></td>
</tr>
<tr class="even">
<td colspan="5">Standard errors in parentheses<br>
<sup>*</sup> <em>p</em> &lt; 0.05, <sup>**</sup> <em>p</em> &lt; 0.01, <sup>***</sup> <em>p</em> &lt; 0.001</td>
</tr>
</tbody>
</table>


</div>
</figure>
</div>
<p>Now, there is a small difference in the produced table because how <code>esttab</code> produces the HTML table. Neverthless, the table creation and naming works!</p>
<p>Also, notice that I’m adding a code chunk <code>=html</code>, so the information can be read correctly.</p>
</section>
<section id="latex-table" class="level2">
<h2 class="anchored" data-anchor-id="latex-table">LaTeX table</h2>
<p>Finally, let’s try with a LaTeX table. The syntax is very similar:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1">::: {#tbl-table3}</span>
<span id="cb4-2">{{&lt; include reg_tex.tex &gt;}}</span>
<span id="cb4-3">Table made with Latex</span>
<span id="cb4-4">:::</span></code></pre></div>
<p>with the following result:</p>
<div id="tbl-table3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-table3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Table made with Latex
</figcaption>
<div aria-describedby="tbl-table3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">

</div>
</figure>
</div>
<p>Ahh! seems this is not working as HTML! The reason is that Latex tables do not render in html. However if you look into the <a href="index.pdf">pdf version</a>, you will see that the table is there, and it is correctly named!</p>
</section>
<section id="cross-referencing" class="level2">
<h2 class="anchored" data-anchor-id="cross-referencing">Cross-referencing</h2>
<p>As you can see Table&nbsp;1 was done with md, Table&nbsp;2 with html and Table&nbsp;3 with LaTeX.</p>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><code>esttab</code> is part of <code>estout</code> package by Ben Jann.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>Quarto</category>
  <guid>https://friosavila.github.io/chatgpt/quar_01_25_2024/</guid>
  <pubDate>Thu, 25 Jan 2024 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Keynes vs Hayek: The Rap battle</title>
  <dc:creator>ChatGPT and Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/ky_hy_08_24_2023/</link>
  <description><![CDATA[ 





<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">60-70%</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">70-75%</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false">85-90%</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" aria-controls="tabset-1-4" aria-selected="false">99%!</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<p><strong>Verse 1:</strong><br>
Step up, it’s history’s duel, let the wisdom flow,<br>
Keynes versus Hayek, where economics takes the blow.<br>
Two titans of thought, on this verbal battleground,<br>
Bringing theories and concepts, making heads spin ’round.</p>
<p><strong>Verse 2:</strong><br>
Keynes, the man with demand, you laid the groundwork,<br>
Government intervention, your doctrine’s unbound.<br>
But Hayek, the free-market sage, you beg to differ,<br>
Spontaneous order, no need for a regulator.</p>
<p><strong>Verse 3:</strong><br>
In the depths of the crisis, Keynes, you had your say,<br>
Pump up demand, let spending lead the way.<br>
But Hayek retorts, the bust is the cure for the boom,<br>
Liquidate malinvestments, let the market resume.</p>
<p><strong>Verse 4:</strong><br>
Keynesian multiplier versus the Hayekian twist,<br>
Debate’s getting heated, theories clenching their fist.<br>
Keynes, you see cycles as part of the game,<br>
Hayek, you’re all about the market’s hidden aim.</p>
<p><strong>Verse 5:</strong><br>
Boom and bust, it’s the story you both unfold,<br>
Economic philosophy, fierce and bold.<br>
Keynes, your government spending, a cure you propose,<br>
While Hayek, you trust the market to naturally impose.</p>
<p><strong>Verse 6:</strong><br>
In the end, it’s ideas that clash and collide,<br>
Keynes and Hayek, your legacies can’t hide.<br>
Economics’ great debate, you’re the stars of the show,<br>
In this rap battle of history, it’s time to let it flow!</p>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<p><strong>Verse 1:</strong><br>
Gather ‘round, it’s time for the great debate,<br>
Keynes and Hayek, let’s seal their fate.<br>
Economics clashin’, theories in the ring,<br>
Listen up close, let the rhymes take wing.</p>
<p><strong>Verse 2:</strong><br>
Keynes steps up, demand’s his game,<br>
Gov intervention, he rides that claim.<br>
But Hayek ain’t buyin’ that plan so neat,<br>
Spontaneous order’s his market beat.</p>
<p><strong>Verse 3:</strong><br>
Keynesian crisis, demand’s the key,<br>
Pump up spendin’, let the market free.<br>
But Hayek drops knowledge, bust cures the boom,<br>
Malinvestments gone, let growth resume.</p>
<p><strong>Verse 4:</strong><br>
Multiplier versus the twist so sly,<br>
In this epic clash, the stakes are high.<br>
Keynes, cycles part of the show,<br>
Hayek trusts the market’s subtle flow.</p>
<p><strong>Verse 5:</strong><br>
Boom and bust, stories they unveil,<br>
Philosophies strong, their visions set sail.<br>
Keynes with his spending, cure he demands,<br>
Hayek waits, lets the unseen work hands.</p>
<p><strong>Verse 6:</strong><br>
Ideas collide, legacies take hold,<br>
Economic philosophies, stories bold.<br>
Keynes and Hayek, stars of the fray,<br>
In this rap battle, let’s let them sway!</p>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<p><strong>Verse 1:</strong><br>
Ladies and gents, gather ’round, let’s ignite the fire,<br>
Keynes and Hayek clashing, watch their thoughts transpire.<br>
In this epic rap, theories locked in strife,<br>
Rhymes slicing through economics, this verbal knife.</p>
<p><strong>Verse 2:</strong><br>
Keynes steps to the mic, demand’s his claim,<br>
Gov intervention’s his ticket to fame.<br>
But Hayek ain’t fooled, free markets in his stance,<br>
Spontaneous order, let the markets dance.</p>
<p><strong>Verse 3:</strong><br>
Keynes rides the wave of crisis, with demand in sight,<br>
Pump up the spending, end the economic plight.<br>
Yet Hayek drops knowledge, bust clears the way,<br>
Liquidate the bad, let markets have their say.</p>
<p><strong>Verse 4:</strong><br>
Multiplier meets the twist, theories collide,<br>
Economic philosophies on this lyrical ride.<br>
Keynes sees cycles, a part of the game,<br>
Hayek trusts the unseen, it’s not all the same.</p>
<p><strong>Verse 5:</strong><br>
Boom and bust, their tales unfold,<br>
Keynes’ spending and Hayek’s markets, bold.<br>
Keynes says cure, more demand to wield,<br>
Hayek’s patient, lets the market’s hand be revealed.</p>
<p><strong>Verse 6:</strong><br>
The clash of ideas, legacies untold,<br>
Keynes and Hayek’s visions, stories unfold.<br>
In this rap battle, they’re the stars of the lore,<br>
Mimicking history, Keynes versus Hayek, encore!</p>
</div>
<div id="tabset-1-4" class="tab-pane" aria-labelledby="tabset-1-4-tab">
<p><strong>Verse 1:</strong><br>
Ladies and gentlemen, assemble, it’s a lyrical throwdown,<br>
Keynes versus Hayek, in this rhyming showdown.<br>
Economic minds clash, theories take the stage,<br>
Strap in tight, witness wisdom engage.</p>
<p><strong>Verse 2:</strong><br>
Keynes steps up bold, demand’s his creed,<br>
Government intervention, that’s the seed he’ll feed.<br>
But Hayek ain’t convinced, the market’s his creed,<br>
Spontaneous order, watch it take the lead.</p>
<p><strong>Verse 3:</strong><br>
Keynes rides the wave of crisis, demand’s the key,<br>
Spending’s his salvation, he insists you’ll see.<br>
Hayek’s counterpunch, bust cures the boom,<br>
Clear the slate, let the market resume.</p>
<p><strong>Verse 4:</strong><br>
Multiplier meets the twist, their theories unfurl,<br>
Economic philosophies, a clash of the world.<br>
Keynes, cycles turn, part of nature’s law,<br>
Hayek’s trust in markets, unseen hands in awe.</p>
<p><strong>Verse 5:</strong><br>
Boom and bust tales, unfold on this stage,<br>
Keynes says spend, economies engage.<br>
Hayek’s calm, the market’s plan unfurls,<br>
Let it heal, no central command swirls.</p>
<p><strong>Verse 6:</strong><br>
Debating ideas, their legacy displayed,<br>
Keynes and Hayek’s visions, history’s cascade.<br>
In this rap battle’s heat, their spirits ignite,<br>
Mimicking history, it’s Keynes and Hayek’s fight!</p>
</div>
</div>
</div>


<!-- -->


 ]]></description>
  <category>ChatGPT</category>
  <category>Rap Battles</category>
  <guid>https://friosavila.github.io/chatgpt/ky_hy_08_24_2023/</guid>
  <pubDate>Thu, 24 Aug 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Weak IV: And the problem of Inference</title>
  <dc:creator>Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/weakiv_08_15_2023/</link>
  <description><![CDATA[ 





<section id="f-geq-10-rightarrow-strong-instrument-or-is-it" class="level2">
<h2 class="anchored" data-anchor-id="f-geq-10-rightarrow-strong-instrument-or-is-it"><img src="https://latex.codecogs.com/png.latex?F%20%5Cgeq%2010%20%5Crightarrow"> Strong instrument! (or is it?)</h2>
<p>If you are “old-school” like me, and you are using instrumental variables, you probably are still relying on the rule thumb of using and <img src="https://latex.codecogs.com/png.latex?F%20%5Cgeq%2010"> to Judge if an instrument is strong enough to proceed and do statistical inference.</p>
<p>This “critical” value was constructed based on the research by <span class="citation" data-cites="Staiger_stock_1997">Staiger and Stock (1997)</span> and <span class="citation" data-cites="stock_yogo2005">Stock and Yogo (2005)</span>, and is still included in introductory econometric textbooks, and thought in econometric courses. This are said to be valid in cases where there is no heteroskedasticity in the model.</p>
<p>As described in Wooldridge’s <strong><em>“Introductory Econometrics: A Modern Approach” 7e</em></strong>, if models are heteroskedastic, it makes sense that more strict requirements are needed to indicate one has a strong Instrument. Specifically, he cites work by <span class="citation" data-cites="olea_pflueger2013">Olea and Pflueger (2013)</span> who suggest that one might need an <img src="https://latex.codecogs.com/png.latex?F%5Cgeq%2020"> to ensure instruments are sufficiently strong.</p>
<p>In <span class="citation" data-cites="lee2022">Lee et al. (2022)</span>, however, the bar to judge an instrument strong has been raised even higher. What they suggest is that one must consider the joint distribution of the first stage “F-stat” statistic and second stage “t-stat”, to make any inference judgements. Specifically, the authors indicate that, in order to use “standard” critical values to judge significance in second stage models (say the 1.96 for and <img src="https://latex.codecogs.com/png.latex?%5Calpha=5%5C%25">), one should have an F-statistic of at least 104.7!. Alternatively, if we keep using an <img src="https://latex.codecogs.com/png.latex?F=10">, the t-stat critical value should be at least 3.43.</p>
</section>
<section id="how-bad-is-the-problem" class="level2">
<h2 class="anchored" data-anchor-id="how-bad-is-the-problem">How bad is the problem?</h2>
<p>While I was perplex at first regarding the “new” requirements for a high “F-stat”, I also understood that this problem was important. Because of this, I decided to do a small simulation study to see how bad the problem was in terms of inference, using different levels of Instruments strength. Let me show you how I did this, and what it tells me in regards to previous beliefs about the <img src="https://latex.codecogs.com/png.latex?F%5Cgeq%2010"> rule.</p>
<p>Bottom line, in my design, an <img src="https://latex.codecogs.com/png.latex?E(F)=10"> is not enough to judge an instrument to be strong enough to guarantee the distribution of the coefficient of interest follows a normal distribution. And, if the distribution of such coefficient is not normal, then standard “t-statistics” may be inappropiate when making statistical inference.</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>For this simulation, I will use a very simple structure that considers a single endogenous variable and a single instrument, without any other controls.</p>
<ul>
<li>First, The common Error: To simulate endogeneity, I will assume there is a common unobserved factor <img src="https://latex.codecogs.com/png.latex?e"> that affects the endogenous variable <img src="https://latex.codecogs.com/png.latex?x"> and outcome <img src="https://latex.codecogs.com/png.latex?y">. This unobserved error is assumed to follow a standardized normal distribution.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?e%5Csim%20N(0,1)"></p>
<ul>
<li>The instrument: The instrument will be a completely independent variable that also follows a standardized normal distribution.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?z%5Csim%20N(0,1)"></p>
<ul>
<li>The endogenous variable: This variable will be created by adding the endogenous common error <img src="https://latex.codecogs.com/png.latex?e">, the instrument <img src="https://latex.codecogs.com/png.latex?z"> and a random error <img src="https://latex.codecogs.com/png.latex?u_x">. To control the strength of the instrument, the endogenous variable <img src="https://latex.codecogs.com/png.latex?x"> is defined as:</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?x=1%20+%20z%20+%20(e+u_x)*%5Csqrt%7B2%5Cfrac%7BN%7D%7BF%7D%7D"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?N"> is the number of observations, and <img src="https://latex.codecogs.com/png.latex?F"> is the Expected Strength of the instrument.</p>
<ul>
<li>The dependent variable: It will combine the common error and a random standardize normal distributed error, and assume <img src="https://latex.codecogs.com/png.latex?x"> has no explanatory power. The common error <img src="https://latex.codecogs.com/png.latex?e"> and the standardized normal distributed error <img src="https://latex.codecogs.com/png.latex?u_y"> are scaled so the combined error has a variance of 1.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?y%20=%201%20+%20(e%20+%20u_y)*%5Csqrt%7B2%7D"></p>
<p>The simulation is run 100’000 times, with a sample of 500 observations each, using various levels of “F-statistics”: 5, 10, 20, 40, 80 and 160. To speed up the simulation excercise, I use <code>parallel</code>, a community-contributed command written <span class="citation" data-cites="VegaYon2019">Vega Yon and Quistorff (2019)</span>. You can find the latest version of it on their <a href="https://github.com/gvegayon/parallel">github</a>.</p>
<p>The code for the simulation program is as follows:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">program</span> simx, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">eclass</span></span>
<span id="cb1-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb1-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">N</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`1'</span></span>
<span id="cb1-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">F</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`2'</span></span>
<span id="cb1-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> sig = <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`N'</span>/ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`F'</span>)</span>
<span id="cb1-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">set</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">obs</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`N'</span></span>
<span id="cb1-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">e</span> = rnormal()</span>
<span id="cb1-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> z = rnormal() </span>
<span id="cb1-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> x = 1 + z + (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">e</span>+rnormal())*<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(.5)*<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sig'</span></span>
<span id="cb1-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">y</span> = 1 + ( <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">e</span> + rnormal())*<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(.5)</span>
<span id="cb1-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reg</span> x z, </span>
<span id="cb1-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span> b=(_b[z]/_se[z])^2</span>
<span id="cb1-13">    ivregress 2sls  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">y</span> (x=z), </span>
<span id="cb1-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span> b=b,_b[x],_b[x]/_se[x]</span>
<span id="cb1-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ereturn</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">post</span> b</span>
<span id="cb1-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">end</span></span></code></pre></div>
<p>and the simulation itself can be run using:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1">net install parallel, from(https:<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//raw.github.com/gvegayon/parallel/stable/) replace</span></span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mata</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mata</span> mlib <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">index</span></span>
<span id="cb2-3">** Initializes number <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">of</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Stata"</span> instances</span>
<span id="cb2-4">parallel initialize 17</span>
<span id="cb2-5">** Some tempfiles to <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">store</span> the simulations</span>
<span id="cb2-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tempfile</span> f0 f1 f2 f3 f4 f5</span>
<span id="cb2-7">** A loop <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> the simulations</span>
<span id="cb2-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">forvalues</span> i = 0/5 {</span>
<span id="cb2-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> j = 5*2^<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span></span>
<span id="cb2-10">    parallel sim, reps(100000): simx 500 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`j'</span></span>
<span id="cb2-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">F</span>=<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`j'</span></span>
<span id="cb2-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">save</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`f`i'</span>'</span>
<span id="cb2-13">}</span>
<span id="cb2-14"> </span>
<span id="cb2-15">** Append and <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">rename</span></span>
<span id="cb2-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span> </span>
<span id="cb2-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">append</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`f0'</span></span>
<span id="cb2-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">append</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`f1'</span></span>
<span id="cb2-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">append</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`f2'</span></span>
<span id="cb2-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">append</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`f3'</span></span>
<span id="cb2-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">append</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`f4'</span></span>
<span id="cb2-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">append</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`f5'</span></span>
<span id="cb2-23"></span>
<span id="cb2-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ren</span> (_b_c1 _b_c2 _b_c3 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">F</span>) (f_stat b_coef t_stat FF)</span></code></pre></div>
<p>If you are interested in the data, it can be downloaded from <a href="weakiv.dta">here</a>. It is a <code>Stata</code> file with 4 variables and 60k observations.</p>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>First, to make sure data was created correctly, we can do a quick summary statistics of the F-statistic of the first stage regression.</p>
<div id="84bcbfc7" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> weakiv, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tabstat</span> f_stat , <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">by</span>(FF) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">stats</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mean</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">median</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Summary for variables: f_stat
Group variable: FF 

      FF |      Mean       p50
---------+--------------------
       5 |  6.012032  4.989151
      10 |  11.03701  10.01228
      20 |   21.0688  19.97883
      40 |  41.13833  39.95357
      80 |  81.26734  79.84747
     160 |  161.4196  159.6645
---------+--------------------
   Total |  53.65718  29.36334
------------------------------</code></pre>
</div>
</div>
<p>The mean is a bit higher than the intended F-Statistic, whereas the median is closer. Both statistics suggesting simulations were created as intended.</p>
<div id="dcc70c98" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">set</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">scheme</span> white2</span>
<span id="cb5-2">color_style tableau</span>
<span id="cb5-3">joy_plot f_stat, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">by</span>(FF) gap0 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(%50) alegend <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F-stat"</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xline</span>(10 20 100)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://friosavila.github.io/chatgpt/weakiv_08_15_2023/index_files/figure-html/cell-3-output-1.png" class="img-fluid figure-img"></p>
<figcaption>F-Statistics Distribution</figcaption>
</figure>
</div>
</div>
</div>
<p>We can also see the distribution of the F-statistics across all simulations.</p>
<p>What about the endogenous variable coefficient?</p>
<p>While we could examine the coefficient themselves, I find it more useful to examine the distribution of the t-statistics in the second Stage.</p>
<div id="1e7ecc3f" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> t_stat || <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">y</span> = <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalden</span>(x) , <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">range</span>(-3 3) , <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">by</span>(FF, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T-stat distribution"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normal"</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">cols</span>(2)) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xline</span>(-1.96 1.96)</span>
<span id="cb6-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">graph</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">export</span> fig1.png, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">width</span>(1000) </span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> t_stat <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> f_stat&gt;10 || <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">y</span> = <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalden</span>(x) , <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">range</span>(-3 3) , <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">by</span>(FF, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T-stat distribution"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normal"</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">cols</span>(2)) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xline</span>(-1.96 1.96)</span>
<span id="cb6-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">graph</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">export</span> fig2.png, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">width</span>(1000) </span></code></pre></div>
</details>
</div>
<div id="fig-fig1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-pos="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fig1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://friosavila.github.io/chatgpt/weakiv_08_15_2023/fig1.png" class="img-fluid figure-img" style="width:80.0%" data-fig-pos="center">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fig1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: T-Stat distribution by E(F)
</figcaption>
</figure>
</div>
<p>What we see from Figure&nbsp;1 is that the distribution of the t-statistic is not consistent with a normal distribution. For and <img src="https://latex.codecogs.com/png.latex?F%5Cleq%2040">, there is a clear discrepancy between the normal distribution (orange) and the empirical t-stat distribution (blue). As consequence, when coefficients are possitive, it is more likely to reject the null hypothesis, but also under-reject when the coefficients are negative.</p>
<p>Once we reach an F-statistic of at least 80 and 160, the difference between the normal distribution and the t-statistic empirical distribution dissapears. Lesson, if your F-stat is “low”, perhaps using standard distributions may be innapropriate.</p>
<p>One problem with the results in Figure&nbsp;1 was that when <img src="https://latex.codecogs.com/png.latex?E(F)"> is low, there are many instances where the F-distribution is less than 10. One may say that is the reason why the distribution is skew in Figure&nbsp;1. A simple way to avoid this is by ploting the same information, but restricting F-statistics to be larger than 10.</p>
<div id="fig-fig2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-pos="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fig2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://friosavila.github.io/chatgpt/weakiv_08_15_2023/fig2.png" class="img-fluid figure-img" style="width:80.0%" data-fig-pos="center">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fig2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: T-Stat distribution by E(F) if F&gt;10
</figcaption>
</figure>
</div>
<p>Unfortunately, the situation is much worse. By constraining the F-statistic to be larger than 10, we are doing the equivalent of p-hacking (F hacking?), which further distorts the distribution of the endogenous variable. While it looks a bit more normal (distributed), we can see now that it over rejects the null hypothesis, if the true F-statistic was, in fact, lower. You can call this evidence of biased estimations.</p>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>This note was prepared with the intention of showing in class the consequences of weak IV’s. While I knew that this was an important problem, it was not completely clear what would the consequences in terms of distribution of the coefficient of interest would be.</p>
<p>Although this simulation is rather limited, it clearly shows problems of using weak instrumental variables (even when using the well known “rule of 10”). When the instrument is weak, even if its completely exogenous, the distribution of the endogenous variable coefficient will not be normal. Thus, further steps may be needed for constructing appropriate Confidence intervals.</p>
<p>Is everything lost? Perhaps not. In <code>Stata</code>, there is the community-contributed command <code>weakiv</code> (ssc install weakiv). This command construct alternative CI that take into account the presence of weak instrumental variables reporting adjusted CI. They seem to be closer to what I expect, based on this simulations.</p>
</section>
<section id="extra" class="level2">
<h2 class="anchored" data-anchor-id="extra">Extra</h2>
<p>Ok, so while you do simulations like this, sometimes, you find very interesting results. Some worth exploring.</p>
<p>What did I see (you may ask)? First, let me concentrate only on the cases with “stronger” IVs. In particular those with an <img src="https://latex.codecogs.com/png.latex?E(F)%5Cleq%2080">. None of the F-statistics is less than 10 across all simulations in this case.</p>
<p>Second, because the F-Statistics have different ranges, I will standardize them across groups. This will make it easier to compare scatter plots.</p>
<div id="e70552a5" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb7-1">** Keeping only FF&gt;=80</span>
<span id="cb7-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span> {</span>
<span id="cb7-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">keep</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> FF&gt;=80</span>
<span id="cb7-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> f_stat2=.</span>
<span id="cb7-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">foreach</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> 80 160 {</span>
<span id="cb7-6">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sum</span> f_stat <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> FF==<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span></span>
<span id="cb7-7">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> f_stat2 = (f_stat-FF)/<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">r</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> FF==<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span></span>
<span id="cb7-8">    }</span>
<span id="cb7-9">}</span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> t_stat  f_stat2 , <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">by</span>(FF , col(3) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ysize</span>(5) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xsize</span>(10) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb7-12">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(T-stat) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Standardized F-Stat"</span>)</span>
<span id="cb7-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">graph</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">export</span> fig3.png, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">width</span>(1000)</span></code></pre></div>
</details>
</div>
<div id="fig-fig3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-pos="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fig3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://friosavila.github.io/chatgpt/weakiv_08_15_2023/fig3.png" class="img-fluid figure-img" style="width:80.0%" data-fig-pos="center">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fig3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: T-Stat vs SF-Stat
</figcaption>
</figure>
</div>
<p>What I see in Figure&nbsp;3 is that higher F-Stats in the first Stage seem to increase the likelihood of the t-value to be positive and significant. Whereas lower F-stats are associated with the opposite (but to a lesser extent possibly due to simulation design).</p>
<div id="ae0c9901" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> t_stat <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inrange</span>(f_stat2,-.65,.7)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb8-2">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> t_stat <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> f_stat2&lt;-.65) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb8-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> t_stat <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> f_stat2&gt;.7) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb8-4">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sF-Stat near 0"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sF-Stat&lt;25thp"</span> 3 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sf-Stat&gt;75thp"</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb8-5">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t-Statistic Distribution"</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>)</span>
<span id="cb8-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">graph</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">export</span> fig4.png, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">width</span>(1000) </span>
<span id="cb8-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> b_coef <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inrange</span>(f_stat2,-.65,.7)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb8-8">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> b_coef <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> f_stat2&lt;-.65) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb8-9">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">kdensity</span> b_coef <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> f_stat2&gt;.7) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb8-10">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sF-Stat near 0"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sF-Stat&lt;25thp"</span> 3 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sf-Stat&gt;75thp"</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb8-11">    <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Coefficient Distribution"</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">ytitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>)</span>
<span id="cb8-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">graph</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">export</span> fig5.png, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">width</span>(1000)    </span></code></pre></div>
</details>
</div>
<div id="fig-fig4" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fig4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-fig4" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-fig4a" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-fig4a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://friosavila.github.io/chatgpt/weakiv_08_15_2023/fig4.png" class="img-fluid figure-img" data-ref-parent="fig-fig4">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-fig4a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) t-Stat Distribution
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-fig4" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-fig4b" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-fig4b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://friosavila.github.io/chatgpt/weakiv_08_15_2023/fig5.png" class="img-fluid figure-img" data-ref-parent="fig-fig4">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-fig4b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Coefficient Distribution
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fig4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Distribution based on Standardized F-Statistic
</figcaption>
</figure>
</div>
<p>Figure&nbsp;4 shows the distribution of both the t-statistic and the coefficient of the endogenous variables for three groups. Observations where the F-statistic is between the 25th and 75th percentile of the distribution (Thus close to the E(F)), and observations for the top (above 75th percentile) and bottom (below 25th percentile) of the distribution. This is similar to the previous conjecture. Even if the instrument is “strong”, if the sample F-statistic is too high or low compared to the E(F), inference may be biased.</p>
<p>This is just conjecture, however, it may be the case that IV’s are more difficult to trust that I previously expected. If your first stage has a high F-Statistic, it may be worth asking:</p>
<blockquote class="blockquote">
<p>is this F-statistic larger than expected?</p>
</blockquote>
<p>If the answer is yes, then you are likely to be over (or under) stating your coefficients.</p>
<p>If the F-statistic is just as large as expected. Then we may be able to trust the estimated coefficients.</p>
</section>
<section id="references" class="level1">



<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-lee2022" class="csl-entry">
Lee, David S., Justin McCrary, Marcelo J. Moreira, and Jack Porter. 2022. <span>“Valid t-Ratio Inference for IV.”</span> <em>American Economic Review</em> 112 (10): 3260–90. <a href="https://doi.org/10.1257/aer.20211063">https://doi.org/10.1257/aer.20211063</a>.
</div>
<div id="ref-olea_pflueger2013" class="csl-entry">
Olea, José Luis Montiel, and Carolin Pflueger. 2013. <span>“A Robust Test for Weak Instruments.”</span> <em>Journal of Business &amp; Economic Statistics</em> 31 (3): 358–69. <a href="https://doi.org/10.1080/00401706.2013.806694">https://doi.org/10.1080/00401706.2013.806694</a>.
</div>
<div id="ref-Staiger_stock_1997" class="csl-entry">
Staiger, Douglas, and James H. Stock. 1997. <span>“Instrumental Variables Regression with Weak Instruments.”</span> <em>Econometrica</em> 65 (3): 557–86. <a href="http://www.jstor.org/stable/2171753">http://www.jstor.org/stable/2171753</a>.
</div>
<div id="ref-stock_yogo2005" class="csl-entry">
Stock, James H, and Motohiro Yogo. 2005. <span>“Testing for Weak Instruments in Linear Iv Regression, in Dwk Andrews and Jh Stock, Eds., Identification and Inference for Econometric Models: Essays in Honor of Thomas j. Rothenberg. Cambridge: Cambridge University Press.”</span> Cambridge University Press, Cambridge, UK.
</div>
<div id="ref-VegaYon2019" class="csl-entry">
Vega Yon, George G., and Brian Quistorff. 2019. <span>“Parallel: A Command for Parallel Computing.”</span> <em>The Stata Journal</em> 19 (3): 667–84. <a href="https://doi.org/10.1177/1536867X19874242">https://doi.org/10.1177/1536867X19874242</a>.
</div>
</div></section></div> ]]></description>
  <category>Stata</category>
  <category>Programming</category>
  <category>Econometrics</category>
  <category>Weak IV</category>
  <guid>https://friosavila.github.io/chatgpt/weakiv_08_15_2023/</guid>
  <pubDate>Tue, 15 Aug 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>How to suest a HDFE</title>
  <dc:creator>Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/suregfe_07_14_2023/</link>
  <description><![CDATA[ 





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>A question I have seen online many…many…many times is how to compare the coefficients of a model that has been estimated using a highdimensional set of fixed effects.</p>
<p>The starting answer has always been…to <code>suest</code> the both equations, or <em>stack</em> both equations to compare the effects. However, <code>suest</code> will not work with <code>reghdfe</code> nor <code>xtreg</code>. And <em>stacking</em> equations is even less intuitive.</p>
<p>Today, however, I will present you an easy way to do this with with a little command of my own creation, but also using some simple syntax.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Setup
</div>
</div>
<div class="callout-body-container callout-body">
<p>To use the strategies I will present here you will need <code>reghdfe</code> (from <code>ssc</code>) and <code>cre</code> (from <code>fra</code>, my own repository). You will need <code>frause</code> from ssc.</p>
</div>
</div>
</section>
<section id="suest-the-problem" class="level2">
<h2 class="anchored" data-anchor-id="suest-the-problem"><code>suest</code> the problem</h2>
<p>Lets start with a simple wage regression model, where we aim to compare the coefficients of men and women. For this, we will use the data set <code>oaxaca</code>, and a simple <em>Mincerian</em> regression model:</p>
<p>First, lets estimate both models:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:frause oaxaca, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reg</span> lnwage educ exper tenure age <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> female==0</span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto male</span>
<span id="cb1-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reg</span> lnwage educ exper tenure age <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> female==1</span>
<span id="cb1-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto female</span></code></pre></div>
</div>
<p>and use <code>suest</code> to put them together, and test if coefficients are different from each other or not. For this I will use <code>lincom</code> and <code>test</code> commands:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>: <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">suest</span> male female</span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lincom</span> [male_mean]:educ-[female_mean]:educ</span>
<span id="cb2-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">test</span> [male_mean=female_mean]:educ</span>
<span id="cb2-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">test</span> [male_mean=female_mean], common</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 ( 1)  [male_mean]educ - [female_mean]educ = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |  -.0300371   .0119579    -2.51   0.012    -.0534741   -.0066001
------------------------------------------------------------------------------

 ( 1)  [male_mean]educ - [female_mean]educ = 0

           chi2(  1) =    6.31
         Prob &gt; chi2 =    0.0120

 ( 1)  [male_mean]educ - [female_mean]educ = 0
 ( 2)  [male_mean]exper - [female_mean]exper = 0
 ( 3)  [male_mean]tenure - [female_mean]tenure = 0
 ( 4)  [male_mean]age - [female_mean]age = 0

           chi2(  4) =   26.63
         Prob &gt; chi2 =    0.0000</code></pre>
</div>
</div>
<p>I could also use more involved methods like creating my own <code>ml</code> or <code>gmm</code> option, but there is no need in this simplified method.</p>
</section>
<section id="stacking" class="level2">
<h2 class="anchored" data-anchor-id="stacking">Stacking</h2>
<p>The next option is do <em>Stacking</em>. This sounds difficult, but its nothing different than using the old trick of interactions. we simply need to estimate a model where all covariates are interacted with our sampling indicator (gender):</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reg</span> lnwage i.female##c.(educ exper tenure age), <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">robust</span></span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lincom</span> 1.female#c.educ</span>
<span id="cb4-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">test</span> 1.female#c.educ</span>
<span id="cb4-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">test</span> 1.female#c.educ 1.female#c.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span> 1.female#c.tenure 1.female#c.age</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 ( 1)  1.female#c.educ = 0

------------------------------------------------------------------------------
      lnwage | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .0300371   .0119956     2.50   0.012     .0065062    .0535681
------------------------------------------------------------------------------

 ( 1)  1.female#c.educ = 0

       F(  1,  1424) =    6.27
            Prob &gt; F =    0.0124

 ( 1)  1.female#c.educ = 0
 ( 2)  1.female#c.exper = 0
 ( 3)  1.female#c.tenure = 0
 ( 4)  1.female#c.age = 0

       F(  4,  1424) =    6.62
            Prob &gt; F =    0.0000</code></pre>
</div>
</div>
<p>Again we will obtain the same results as before.</p>
<p>But now the hard question. What if we have a HDFE?</p>
</section>
<section id="stacking-fe" class="level2">
<h2 class="anchored" data-anchor-id="stacking-fe">Stacking FE</h2>
<p>To simulate the sitution of a high-dimensional FE, I will use <code>age</code>. This will allow me to still obtain point estimates using simple regression (and say <code>suest</code>), while comparing it to the alternative:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reg</span> lnwage educ exper tenure i.age <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> female==0</span>
<span id="cb6-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto male</span>
<span id="cb6-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reg</span> lnwage educ exper tenure i.age <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> female==1</span>
<span id="cb6-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto female</span>
<span id="cb6-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">suest</span> male female, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">cluster</span>(age)</span>
<span id="cb6-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lincom</span> [male_mean]:educ-[female_mean]:educ</span>
<span id="cb6-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">test</span> [male_mean=female_mean]:educ exper tenure</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 ( 1)  [male_mean]educ - [female_mean]educ = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |  -.0354668   .0095251    -3.72   0.000    -.0541357   -.0167978
------------------------------------------------------------------------------

 ( 1)  [male_mean]educ - [female_mean]educ = 0
 ( 2)  [male_mean]exper - [female_mean]exper = 0
 ( 3)  [male_mean]tenure - [female_mean]tenure = 0

           chi2(  3) =   30.72
         Prob &gt; chi2 =    0.0000</code></pre>
</div>
</div>
<p>Now the second method, using <code>reghdfe</code></p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> age_fem = <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span>(age  fem)</span>
<span id="cb8-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:reghdfe lnwage i.female##c.(educ exper tenure), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(female#age) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">cluster</span>(age_fem)</span>
<span id="cb8-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lincom</span> 1.female#c.educ</span>
<span id="cb8-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">test</span> 1.female#c.educ 1.female#c.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span> 1.female#c.tenure </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 ( 1)  1.female#c.educ = 0

------------------------------------------------------------------------------
      lnwage | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .0354668   .0104804     3.38   0.001     .0146424    .0562911
------------------------------------------------------------------------------

 ( 1)  1.female#c.educ = 0
 ( 2)  1.female#c.exper = 0
 ( 3)  1.female#c.tenure = 0

       F(  3,    89) =    6.49
            Prob &gt; F =    0.0005</code></pre>
</div>
</div>
</section>
<section id="using-suest-and-correlated-random-effects-model-cre" class="level2">
<h2 class="anchored" data-anchor-id="using-suest-and-correlated-random-effects-model-cre">Using <code>suest</code> and correlated random effects model <code>cre</code></h2>
<p>Now we use Correlated Random Effects model to estimate the FE models:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:cre, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">keep</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">prefix</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ml</span>) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(age):<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reg</span> lnwage educ exper tenure <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> female==0</span>
<span id="cb10-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto male</span>
<span id="cb10-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:cre, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">keep</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">prefix</span>(m2) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(age):<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reg</span> lnwage educ exper tenure <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> female==1</span>
<span id="cb10-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto female</span>
<span id="cb10-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">suest</span> male female, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">cluster</span>(age)</span>
<span id="cb10-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lincom</span> [male_mean]:educ-[female_mean]:educ</span>
<span id="cb10-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">test</span> [male_mean=female_mean]:educ exper tenure</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 ( 1)  [male_mean]educ - [female_mean]educ = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |  -.0354668   .0095251    -3.72   0.000    -.0541357   -.0167978
------------------------------------------------------------------------------

 ( 1)  [male_mean]educ - [female_mean]educ = 0
 ( 2)  [male_mean]exper - [female_mean]exper = 0
 ( 3)  [male_mean]tenure - [female_mean]tenure = 0

           chi2(  3) =   30.72
         Prob &gt; chi2 =    0.0000</code></pre>
</div>
</div>
<p>Which gives me exactly the same result!</p>
</section>
<section id="hard-example" class="level2">
<h2 class="anchored" data-anchor-id="hard-example">Hard Example:</h2>
<p>Lets do this with a harder example, using <code>nlswork</code> dataset, comparing of a wage regression coefficients between north and south:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb12-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">webuse</span> nlswork, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb12-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> cl = <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span>(idcode south)</span>
<span id="cb12-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>: reghdfe ln_wage i.south##c.(age msp  not_smsa c_city <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">union</span> tenure hours) , <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(idcode#south) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">cluster</span>(cl)</span>
<span id="cb12-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">test</span> 1.south#c.age 1.south#c.msp 1.south#c.<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">union</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(National Longitudinal Survey of Young Women, 14-24 years old in 1968)
(8 missing values generated)

 ( 1)  1.south#c.age = 0
 ( 2)  1.south#c.msp = 0
 ( 3)  1.south#c.union = 0

       F(  3,  3586) =    1.24
            Prob &gt; F =    0.2941</code></pre>
</div>
</div>
<p>But also using CRE:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">webuse</span> nlswork, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb14-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:cre, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(idcode) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">keep</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">prefix</span>(m1): <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">regress</span> ln_wage age msp not_smsa c_city <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">union</span> tenure hours <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> south==0  </span>
<span id="cb14-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto north</span>
<span id="cb14-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:cre, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(idcode) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">keep</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">prefix</span>(m2): <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">regress</span> ln_wage age msp not_smsa c_city <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">union</span> tenure hours <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> south==1  </span>
<span id="cb14-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">est</span> sto south</span>
<span id="cb14-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">suest</span> north south</span>
<span id="cb14-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">test</span> [north_mean=south_mean]: age msp <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">union</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(National Longitudinal Survey of Young Women, 14-24 years old in 1968)

 ( 1)  [north_mean]age - [south_mean]age = 0
 ( 2)  [north_mean]msp - [south_mean]msp = 0
 ( 3)  [north_mean]union - [south_mean]union = 0

           chi2(  3) =    3.82
         Prob &gt; chi2 =    0.2821</code></pre>
</div>
</div>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>There you have it. Two ways to compare coefficients across two models using interactions or <code>suest</code>.</p>
<p>Both provide the same results, if you cluster variables with the absorbed variable.</p>
<p>Hope you find it useful</p>


<!-- -->

</section>

 ]]></description>
  <category>Stata</category>
  <category>Programming</category>
  <category>Fixed Effects</category>
  <guid>https://friosavila.github.io/chatgpt/suregfe_07_14_2023/</guid>
  <pubDate>Fri, 14 Jul 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Renaming variables in Bulk</title>
  <dc:creator>Fernando Rios-Avila and Fahad Mirza</dc:creator>
  <link>https://friosavila.github.io/chatgpt/ren_06_02_2023/</link>
  <description><![CDATA[ 





<section id="aknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="aknowledgements">Aknowledgements</h2>
<p>This tip was brought to you by Fahad Mirza. Its one of those little things I have found useful, but usually forget, and have to look for it all over again.</p>
<p>Luckily, I know have my own site, where I can save and store this information! I give, however, total creadit to Fahad.</p>
</section>
<section id="the-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-problem">The problem</h2>
<p>The problem is simple. Some times, you may have a series of variables with somewhat unappealing names. I particuarly dislike names that are too long. While some people like having descriptive variable names, I find it particularly distracting.</p>
<p>My preference is to have variables with good labels, and/or good value labels, whenever necessary. For variables themselves, I like short names, that are descriptive, however, I also like to have them labeled sequentially!.</p>
<p>How do we do that?</p>
<p>Obviously, the first approach is to go one by one. In fact, not too many <code>Stata's</code> ago, that was the only option. That particular task could have been done using loops as follows:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> auto, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb1-2">* This loop iterates <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">over</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">all</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">variable</span> names <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> the dataset</span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">foreach</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">of</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">varlist</span> * {</span>
<span id="cb1-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> j = <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`j'</span>+1</span>
<span id="cb1-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ren</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span> var_<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`j'</span></span>
<span id="cb1-6">}</span>
<span id="cb1-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">describe</span> *</span></code></pre></div>
<div class="cell-output cell-output-display">
<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(1978 automobile data)

Variable      Storage   Display    Value
    name         type    format    label      Variable label
-------------------------------------------------------------------------------
var_1           str18   %-18s                 Make and model
var_2           int     %8.0gc                Price
var_3           int     %8.0g                 Mileage (mpg)
var_4           int     %8.0g                 Repair record 1978
var_5           float   %6.1f                 Headroom (in.)
var_6           int     %8.0g                 Trunk space (cu. ft.)
var_7           int     %8.0gc                Weight (lbs.)
var_8           int     %8.0g                 Length (in.)
var_9           int     %8.0g                 Turn circle (ft.)
var_10          int     %8.0g                 Displacement (cu. in.)
var_11          float   %6.2f                 Gear ratio
var_12          byte    %8.0g      origin     Car origin</code></pre>
</div>
</div>
</section>
<section id="there-is-a-better-way" class="level2">
<h2 class="anchored" data-anchor-id="there-is-a-better-way">There is a better way</h2>
<p>While the process above is rather simple, there is a better way of doing this, as Fahad suggests. That is using some of the extended options of <code>rename</code>.</p>
<p>Lets first replicate the code above, using the code that Fahad suggested.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> auto, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ren</span> (*) (var_#), addnumber</span>
<span id="cb3-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">describe</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1978 automobile data)

Contains data from C:\Program Files\Stata17/ado\base/a/auto.dta
 Observations:            74                  1978 automobile data
    Variables:            12                  13 Apr 2020 17:45
                                              (_dta has notes)
-------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
-------------------------------------------------------------------------------
var_1           str18   %-18s                 Make and model
var_2           int     %8.0gc                Price
var_3           int     %8.0g                 Mileage (mpg)
var_4           int     %8.0g                 Repair record 1978
var_5           float   %6.1f                 Headroom (in.)
var_6           int     %8.0g                 Trunk space (cu. ft.)
var_7           int     %8.0gc                Weight (lbs.)
var_8           int     %8.0g                 Length (in.)
var_9           int     %8.0g                 Turn circle (ft.)
var_10          int     %8.0g                 Displacement (cu. in.)
var_11          float   %6.2f                 Gear ratio
var_12          byte    %8.0g      origin     Car origin
-------------------------------------------------------------------------------
Sorted by: var_12
     Note: Dataset has changed since last saved.</code></pre>
</div>
</div>
<p>This is a much shorter, and cleaner code. What it does is take all variables within the first parenthesis to be rename using the instructions of the second set. Of course rename has quite few other options that you may find useful. Just type <code>help rename group</code>, to see all other extended options.</p>
<p>Before ending this <code>tip</code>. Something else you may find useful. You can use the option <code>dryrun</code>. Doing this none of the variable names will change, but instead you will see a report of how variable names will change after the command is executed.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> auto, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb5-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ren</span> (*) (var_#), addnumber dryrun</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1978 automobile data)

       oldname | newname
  -------------+-------------
          make | var_1
         price | var_2
           mpg | var_3
         rep78 | var_4
      headroom | var_5
         trunk | var_6
        weight | var_7
        length | var_8
          turn | var_9
  displacement | var_10
    gear_ratio | var_11
       foreign | var_12
  ---------------------------</code></pre>
</div>
</div>


<!-- -->

</section>

 ]]></description>
  <category>Stata</category>
  <category>Tips</category>
  <guid>https://friosavila.github.io/chatgpt/ren_06_02_2023/</guid>
  <pubDate>Fri, 02 Jun 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Synthetic Control: Role of rescaling</title>
  <dc:creator>Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/synth_05_09_2023/</link>
  <description><![CDATA[ 





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>As a wise man once said:</p>
<blockquote class="blockquote">
<p><strong>The best way to learn something is to teach it.</strong></p>
</blockquote>
<p>Not sure who said that, but I find it to be true, except for instances when the learning process puts you in a position where you have a question, but you do not know how to find an answer. This is one of those ocasions.</p>
<p>As some of you may know, the technique known as <strong>Synthetic Control</strong> is a widely recognized methodology used to determine the effects of a treatment on a single treated entity. It accomplishes this by identifying the optimal combination of control variables that form a synthetic control.</p>
<p>The purpose of this SControl is to provide an answer to the question of “What would have happened to the treated group <strong>if</strong> no treatment had been administered?”</p>
<p>However, when dealing with a single unit of interest, there is a risk of mistaking random fluctuations with the actual treatment effect. To mitigate this risk one may run a set of placebo tests. One of them involves estimating pseudo treatment effects for each individual “control” unit. Ideally, if the controls were adequate, there should be no discernible effect among them. If the impact on the treated group is significant or unusual enough, we could conclude that there is an effect beyond random chance or noise.</p>
<p>Because the optimal weights are such you can only construct synthetic controls via interpolation, rather than extrapolation, the estimation of synthetic controls for some of the non-treated units can be difficult. <em>Unique</em> units may serve well as controls, but are not suitable as <em>treated</em> unit, because no interpolation of data can simulate those units. Because of this, its recommended that one excludes those units when analyzing the significance of the treatment effect.</p>
</section>
<section id="how-does-sc-works" class="level2">
<h2 class="anchored" data-anchor-id="how-does-sc-works">How does SC works?</h2>
<p>The basic implementation of SC involves finding a set of optimal weights <img src="https://latex.codecogs.com/png.latex?w"> such that:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Aw%5E*=%5Cmin_w%20%5Csum_%7Bh%7D%20%5Cleft(X_%7B1,h%7D-%5Csum_%7Bj=2%7D%5EJ%20w_j%20X_%7Bj,h%7D%5Cright)%5E2%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?X's"> is a set of pre-treatment characteristics we would like to equalize between the treated unit and the control units. <img src="https://latex.codecogs.com/png.latex?X"> can contain pretreament outcome characteristics. We also require <img src="https://latex.codecogs.com/png.latex?%5Csum%20w_j%20=1"> and <img src="https://latex.codecogs.com/png.latex?w_j%5Cgeq%200">.</p>
<p>Once the weights have been estimated, we can estimate the treatment effect at any point in time simply as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%20%5Ctau_t%20=%20Y_%7B1,t%7D-%5Csum_%7Bj=2%7D%5EJ%20w%5E*_j%20%5Ctimes%20Y_%7Bj,t%7D%0A"></p>
</section>
<section id="the-question-without-an-answer" class="level2">
<h2 class="anchored" data-anchor-id="the-question-without-an-answer">The question without an answer</h2>
<p>Something that seems interesting to me is that the construction of treatment effects, or estimation of optimal weights say nothing about how should data be used, nor which variation should we be interested in.</p>
<p>Granted, standard approach is to just use data asis, but that seems unsatisfactory. Consider, for example, a case when the interest is on analyzing the effect on GDP of a country level policy in the US. The US being one of the largest economies in the world, it would be difficult, if not impossible to, ex ante, find good controls.</p>
<p>But what if we change the measure of interest? and look into GDP percapita, or GDP relative levels, or something else. After the estimation is done, we could certainly reconstruct the original question.</p>
<p>Implementing these kind of transformations would help finding better controls, but could have important impacts when estimating the placebo tests assessing the significance of the estimated effect. Here the question:</p>
<blockquote class="blockquote">
<p><strong>To what extend can we transform our explanatory variables when implementing SC</strong> <strong>Would the transformations need to be the same for all units? or panel units?</strong></p>
</blockquote>
<p>Below, I show an example of what could happen when we make these decisions:</p>
</section>
<section id="smoking-in-california" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="smoking-in-california">Smoking in California</h2>
<p>For the example I have in mind, I will use the <strong><code>Smoking</code></strong> dataset that is typically used to teach the methodology. I will also use two community-contributed programs <code>synth</code> and <code>frause</code>. The second one, just to make it easy uploading the data.</p>
<p>I will also use a small programm to prepare the data before creating the figures. This one is rather long, but if you are interested, please take a look.</p>
<div class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">set</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">scheme</span> white2</span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">capture</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">program</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">drop</span> sc_doer</span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">program</span> sc_doer</span>
<span id="cb1-4">** Estimates the Effect <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> California.</span>
<span id="cb1-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tempfile</span> sc3</span>
<span id="cb1-6">    synth cigsale cigsale(1971) cigsale(1975) cigsale(1980)   cigsale(1985), trunit(3) trperiod(1989) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">keep</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc3'</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>  </span>
<span id="cb1-7">** And <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">all</span> other states</span>
<span id="cb1-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">forvalues</span> i =1/39{</span>
<span id="cb1-9">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>!=3 {</span>
<span id="cb1-10">            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> pool</span>
<span id="cb1-11">            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">foreach</span> j <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">of</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> stl {</span>
<span id="cb1-12">                <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`j'</span>!=3 &amp; <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`j'</span>!=<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> pool <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`pool'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`j'</span></span>
<span id="cb1-13">            }</span>
<span id="cb1-14">            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tempfile</span> sc<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span></span>
<span id="cb1-15">            synth cigsale cigsale(1971) cigsale(1975) cigsale(1980) cigsale(1985) , <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb1-16">            trunit(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>) trperiod(1989) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">keep</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc`i'</span>') <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> counit(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`pool'</span>)</span>
<span id="cb1-17">        }</span>
<span id="cb1-18">    }</span>
<span id="cb1-19">** Collects the Saved files to estimate the Treatment effect</span>
<span id="cb1-20">** and the <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">p</span>-<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">value</span>/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ratio</span> statistic</span>
<span id="cb1-21"></span>
<span id="cb1-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">forvalues</span> i =1/39{</span>
<span id="cb1-23">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc`i'</span>' , <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb1-24">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> tef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span> = _Y_treated - _Y_synthetic</span>
<span id="cb1-25">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>a =<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mean</span>( (_Y_treated - _Y_synthetic)^2) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> _time&lt;=1988</span>
<span id="cb1-26">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>b =<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mean</span>( (_Y_treated - _Y_synthetic)^2) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> _time&gt;1988</span>
<span id="cb1-27">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>aa=<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>a[2])</span>
<span id="cb1-28">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>bb=<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>b[_N])</span>
<span id="cb1-29">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>a=sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>aa</span>
<span id="cb1-30">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>b=sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>bb</span>
<span id="cb1-31">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">drop</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> _time==.</span>
<span id="cb1-32">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">keep</span> tef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span> sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>* _time</span>
<span id="cb1-33">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">save</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc`i'</span>', <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span></span>
<span id="cb1-34">    }</span>
<span id="cb1-35"></span>
<span id="cb1-36">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb1-37">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc1'</span></span>
<span id="cb1-38">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">forvalues</span> i = 2/39 {</span>
<span id="cb1-39">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> 1:1 _time <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc`i'</span>', nogen</span>
<span id="cb1-40">    }</span>
<span id="cb1-41">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">global</span> toplot</span>
<span id="cb1-42">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">global</span> toplot2</span>
<span id="cb1-43">** Stores which models will <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">be</span> saved <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> plotting    </span>
<span id="cb1-44">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">forvalues</span> i = 1/39 {</span>
<span id="cb1-45">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">global</span> toplot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$toplot</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> tef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span> _time, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(gs11) )</span>
<span id="cb1-46">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>a[1])&lt;(2*sef3a[1]) {</span>
<span id="cb1-47">            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">global</span> toplot2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$toplot2</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> tef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span> _time, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(gs11) )</span>
<span id="cb1-48">        }</span>
<span id="cb1-49">    }</span>
<span id="cb1-50">** Estimates the <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">post</span>/pre RMSE <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ratio</span></span>
<span id="cb1-51">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">capture</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">drop</span> rt</span>
<span id="cb1-52">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">forvalues</span> i = 1/39 {</span>
<span id="cb1-53">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>a[1])&lt;(2*sef3a[1]) {</span>
<span id="cb1-54">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span> rt=<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nullmat</span>(rt)\[<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>,sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>b[1]/sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>a[1]]</span>
<span id="cb1-55">        }</span>
<span id="cb1-56">    }</span>
<span id="cb1-57">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">svmat</span> rt</span>
<span id="cb1-58">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> rnk=<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rank</span>(rt2)</span>
<span id="cb1-59">** and the ranking /<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">p</span>-<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">value</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> each period</span>
<span id="cb1-60">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> rnk2=0</span>
<span id="cb1-61">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">forvalues</span> i = 1/39 {</span>
<span id="cb1-62">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>   (sef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>a[1])&lt;(2*sef3a[1]) {</span>
<span id="cb1-63">            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> t = <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`t'</span>+1</span>
<span id="cb1-64">            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> rnk2=rnk2+(tef<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>&lt;=tef3)    </span>
<span id="cb1-65">        }</span>
<span id="cb1-66">    } </span>
<span id="cb1-67">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> pv=rnk2*100/<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`t'</span></span>
<span id="cb1-68"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">end</span></span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
<section id="asis-case" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="asis-case">ASIS case</h3>
<p>The first case will be the “vanilla” one. I will only use 4 pretreatment outcomes for the weight construction: 1971, 1975, 1980 and 1985. The outcome of interest is cigarette sale per capita (in packs). Thus, to some extend, data has already been standardized to be measured in comparable units.</p>
<p>The basic code will look like this:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1">synth cigsale cigsale(1971) cigsale(1975) cigsale(1980)   cigsale(1985), trunit(3) trperiod(1989) </span></code></pre></div>
<div class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:frause smoking2, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:xtset state <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span></span>
<span id="cb4-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span> state <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span></span>
<span id="cb4-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:sc_doer</span></code></pre></div>
</details>
</div>
<p>which will produce the following:</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$toplot</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> tef3 _time, lw(1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">navy</span>*.8)), <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xline</span>(1989) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m1, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>)</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$toplot2</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> tef3 _time, lw(1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">navy</span>*.8)), <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xline</span>(1989) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m2, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>)</span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">bar</span> rt2 rnk || <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">bar</span> rt2 rnk <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> rt1==3 , <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>( 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"California"</span>)) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m3, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>)</span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">bar</span> pv _time <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> _time&gt;1988 &amp; pv&lt;40, <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m4, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ylabel</span>(0(5)25)</span></code></pre></div>
</details>
<div id="fig-sc1" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-sc1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-full">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc1" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc1-1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc1-output-1.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc1">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Unrestricted effect
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc1" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc1-2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc1-output-2.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc1">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Restricted effect
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row page-full">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc1" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc1-3" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc1-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc1-output-3.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc1">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc1-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) RMSE Ratio
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc1" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc1-4" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc1-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc1-output-4.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc1">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc1-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) P-value
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sc1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Synthetic Control Results: ASIS
</figcaption>
</figure>
</div>
<p>Based on Figure&nbsp;1, there is an effect of the Policy which reduced sales of cigarates. Figure&nbsp;1 (c) and Figure&nbsp;1 (d) suggest the effect is significant across most post-treatment periods.</p>
</section>
<section id="log-case" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="log-case">Log Case</h3>
<p>Lets make one change. Instead of using cigarette sale per capita, I will use the log of that variable. The idea is that while raw data may not be comparable, because of different scales across units, data may be more comparable if its comparessed using a logScale.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$toplot</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> tef3 _time, lw(1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">navy</span>*.8)), <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xline</span>(1989) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m1, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>)</span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$toplot2</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> tef3 _time, lw(1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">navy</span>*.8)), <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xline</span>(1989) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m2, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>)</span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">bar</span> rt2 rnk || <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">bar</span> rt2 rnk <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> rt1==3 , <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>( 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"California"</span>)) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m3, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>)</span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">bar</span> pv _time <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> _time&gt;1988 &amp; pv&lt;40, <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m4, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ylabel</span>(0(5)25)</span></code></pre></div>
</details>
<div id="fig-sc2" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-sc2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-full">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc2-1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc2-output-1.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc2">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Unrestricted effect
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc2-2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc2-output-2.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc2">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Restricted effect
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row page-full">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc2-3" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc2-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc2-output-3.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc2">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc2-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) RMSE Ratio
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc2-4" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc2-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc2-output-4.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc2">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc2-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) P-value
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sc2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Synthetic Control Results: Logs
</figcaption>
</figure>
</div>
<p>Interestingly enough Figure&nbsp;2 shows a very similar effect plot as in Figure&nbsp;1. The RMSE ratio is even better, but with few post-treatment effects that are not as significant.</p>
</section>
<section id="relative-change" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="relative-change">Relative Change</h3>
<p>The next alternative is to use a relative rescaling. Specifically, I will change the baseline of cigsales across all States, so that Cigarette Sales in 1970 is normalized to be 100. The changes, then could be interpreted in units relative to what happened in 1970.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$toplot</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> tef3 _time, lw(1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">navy</span>*.8)), <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xline</span>(1989) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m1, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>)</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$toplot2</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> tef3 _time, lw(1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">navy</span>*.8)), <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xline</span>(1989) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m2, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>)</span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">bar</span> rt2 rnk || <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">bar</span> rt2 rnk <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> rt1==3 , <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>( 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"California"</span>)) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m3, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>)</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">bar</span> pv _time <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> _time&gt;1988 &amp; pv&lt;40, <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m4, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ylabel</span>(0(5)25)</span></code></pre></div>
</details>
<div id="fig-sc3" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-sc3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-full">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc3" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc3-1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc3-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc3-output-1.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc3">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc3-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Unrestricted effect
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc3" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc3-2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc3-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc3-output-2.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc3">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc3-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Restricted effect
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row page-full">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc3" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc3-3" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc3-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc3-output-3.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc3">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc3-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) RMSE Ratio
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc3" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc3-4" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc3-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc3-output-4.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc3">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc3-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) P-value
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sc3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Synthetic Control Results: Logs
</figcaption>
</figure>
</div>
<p>Based on Figure&nbsp;3, we still have many states with very bad model fitness. Figure&nbsp;3 (c) and Figure&nbsp;3 (d), however, still shows good model performance, with slighly higher significance than when the data was used as is.</p>
</section>
<section id="fully-rescale-to-california-pre-treament" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="fully-rescale-to-california-pre-treament">Fully Rescale (to California pre-treament)</h3>
<p>The last transformation I implement is one where all data is rescaled and shifted so that all countries have the same average and standard deviation in the period before treatment. I believe this could be the best approach, because forces all data to be perfectly comparable in the pre-treatment period, increasing the posibility to find good controls even for the other wise extreme states.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$toplot</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> tef3 _time, lw(1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">navy</span>*.8)), <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xline</span>(1989) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m1, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>)</span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">$toplot2</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">line</span> tef3 _time, lw(1) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span>(<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">navy</span>*.8)), <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xline</span>(1989) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m2, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>)</span>
<span id="cb8-4"></span>
<span id="cb8-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">bar</span> rt2 rnk || <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">bar</span> rt2 rnk <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> rt1==3 , <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>( 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"California"</span>)) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m3, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>)</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">two</span> <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">bar</span> pv _time <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> _time&gt;1988 &amp; pv&lt;40, <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">off</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span>(m4, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ylabel</span>(0(5)25)</span>
<span id="cb8-8">frame put *, into(m4)</span></code></pre></div>
</details>
<div id="fig-sc4" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-sc4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-full">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc4" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc4-1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc4-output-1.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc4">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Unrestricted effect
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc4" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc4-2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc4-output-2.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc4">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Restricted effect
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row page-full">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc4" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc4-3" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc4-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc4-output-3.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc4">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc4-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) RMSE Ratio
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-sc4" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sc4-4" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-sc4-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc4-output-4.png" class="img-fluid figure-img column-page" data-ref-parent="fig-sc4">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sc4-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) P-value
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sc4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Synthetic Control Results: Rescale to California
</figcaption>
</figure>
</div>
<p>What I consider quite interesting is that even the effect plot that uses no restrictions shows very good pre-treatment model fit for all donor units. Although the fitness for California is even better. Once we impose the same restriction to the data, excluding units with a RMSE twice as large as the one in California, we obtain a plot similar to the ones in the previous cases.</p>
<p>Figure&nbsp;4 (c) and Figure&nbsp;4 (d) show that the effect may not be as strong as in the previous example. The RMSE ratio method suggests a p-value of 12.5%, above the standard 5% we like to consider as minimum threshold. The significance across periods is also slighly worse, because there is one state that exhibits a pseudo treatment that is larger than California.</p>
</section>
</section>
<section id="comparing-magnitude-effects" class="level2">
<h2 class="anchored" data-anchor-id="comparing-magnitude-effects">Comparing Magnitude effects</h2>
<div class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:frause smoking2, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb9-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tempfile</span> sc1x sc2x sc3x sc4x</span>
<span id="cb9-3">xtset state <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span></span>
<span id="cb9-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>: {</span>
<span id="cb9-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> or_cigsale=cigsale</span>
<span id="cb9-6">    synth cigsale cigsale(1971) cigsale(1975) cigsale(1980)   cigsale(1985), trunit(3) trperiod(1989) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">keep</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc1x'</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>  </span>
<span id="cb9-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> cigsale=<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(or_cigsale)</span>
<span id="cb9-8">    synth cigsale cigsale(1971) cigsale(1975) cigsale(1980)   cigsale(1985), trunit(3) trperiod(1989) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">keep</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc2x'</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>  </span>
<span id="cb9-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span> state <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span></span>
<span id="cb9-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">by</span> state:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> cigsale=or_cigsale/or_cigsale[1]*100</span>
<span id="cb9-11">    synth cigsale cigsale(1971) cigsale(1975) cigsale(1980)   cigsale(1985), trunit(3) trperiod(1989) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">keep</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc3x'</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>  </span>
<span id="cb9-12"></span>
<span id="cb9-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sum</span> or_cigsale <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> state==3 &amp; <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>&lt;=1988</span>
<span id="cb9-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> cmean=<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">r</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mean</span>)</span>
<span id="cb9-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> smean=<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">r</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>)</span>
<span id="cb9-16">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">forvalues</span> i = 1/39 {</span>
<span id="cb9-17">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sum</span> or_cigsale <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> state==<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span> &amp; <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>&lt;=1988</span>
<span id="cb9-18">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> cigsale = <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`cmean'</span> + <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`smean'</span> * (or_cigsale - <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">r</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mean</span>))/<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">r</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> state==<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span></span>
<span id="cb9-19">    }</span>
<span id="cb9-20">    synth cigsale cigsale(1971) cigsale(1975) cigsale(1980)   cigsale(1985), trunit(3) trperiod(1989) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">keep</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc4x'</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span>  </span>
<span id="cb9-21">}</span>
<span id="cb9-22"></span>
<span id="cb9-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb9-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc1x'</span></span>
<span id="cb9-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">rename</span>  _Y_synthetic y1_synth</span>
<span id="cb9-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">drop</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> _time==.</span>
<span id="cb9-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">save</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc1x'</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span></span>
<span id="cb9-28"></span>
<span id="cb9-29"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc2x'</span></span>
<span id="cb9-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">rename</span>  _Y_synthetic y2_synth</span>
<span id="cb9-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> y2_synth = <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(y2_synth )</span>
<span id="cb9-32"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">drop</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> _time==.</span>
<span id="cb9-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">save</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc2x'</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span></span>
<span id="cb9-34"></span>
<span id="cb9-35"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc3x'</span></span>
<span id="cb9-36"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ren</span> _Y_synthetic y3_synth</span>
<span id="cb9-37"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">drop</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> _time==.</span>
<span id="cb9-38"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">save</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc3x'</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span></span>
<span id="cb9-39"></span>
<span id="cb9-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc4x'</span></span>
<span id="cb9-41"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ren</span> _Y_synthetic y4_synth</span>
<span id="cb9-42"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">drop</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> _time==.</span>
<span id="cb9-43"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">save</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc4x'</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span></span>
<span id="cb9-44"></span>
<span id="cb9-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc1x'</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb9-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> 1:1 _time <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc2x'</span>, nogen</span>
<span id="cb9-47"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> 1:1 _time <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc3x'</span>, nogen</span>
<span id="cb9-48"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> 1:1 _time <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`sc4x'</span>, nogen</span>
<span id="cb9-49"></span>
<span id="cb9-50"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> y3_synth=y3_synth* _Y_treated[1]/100</span>
<span id="cb9-51"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> eff1= _Y_treated-y1_synth</span>
<span id="cb9-52"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> eff2= _Y_treated-y2_synth</span>
<span id="cb9-53"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> eff3= _Y_treated-y3_synth</span>
<span id="cb9-54"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> eff4= _Y_treated-y4_synth</span></code></pre></div>
</details>
</div>
<p>Perhaps what would be the best way to comapre the different cases presented above is to rescale the results as to obtain results that can be compared across specifications. In Figure&nbsp;5, I puts together this effects, so that they can be compared across each other.</p>
<div class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">scatter</span> eff* _time, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">connect</span>(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">l</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">l</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">l</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">l</span>) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">msymbol</span>(O D T S) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">xline</span>(1989) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">///</span></span>
<span id="cb10-2"><span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">legend</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span>(1 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asis  2.550"</span> 2 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Logs 2.859"</span> 3 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rate 1.928"</span> 4 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rescaled 1.955"</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-sc5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sc5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://friosavila.github.io/chatgpt/synth_05_09_2023/index_files/figure-html/fig-sc5-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sc5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Synthetic Control Effects
</figcaption>
</figure>
</div>
</div>
</div>
<p>Interestingly enough, Model Specification does very little on the estimated effect, as they all suggest a sharp decline in Cigarette sales of just above 10 fewer packs per capita 3 years after implementation, up to 25/27 fewer packs per capita by 2000.</p>
<p>Asis and Logs specifications show the largest decline in 1997 (30 fewer packs), with rescaled and rate specifications being the most conservative. The table also provides the pre-RMSE for all models. They suggest that using Rates provided the best fit, followed by the ReScaled data, using data as is, and using the log transformation.</p>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>This was an interesting excercise driven by asking if it matter how the covariates are measured when applying SC. I was also curious about this approach, as I was trying to understand one of the extensions of the methodology: Synthetid Differences in Differences. This may require some testing, but that can be left for a future exploration.</p>
<p>It may seem, for this simplified example, that it doesnt really matter how covariates are transformed. The estimated effects were effectively the same. This conclusion, however, may not be valid in more complex settings.</p>
<p>Perhaps the only concern at this point is that the “significance” level of the estimates did change considerably with the data rescaling approach. Granted, the change seems large, because the sample is small (25 observations), and a single change in ranking may look like a large change in the p-value of the statistic.</p>
<p>If you are reading this, and have some comments, please let me know.</p>


<!-- -->

</section>

 ]]></description>
  <category>Stata</category>
  <category>Programming</category>
  <category>Causal effects</category>
  <guid>https://friosavila.github.io/chatgpt/synth_05_09_2023/</guid>
  <pubDate>Tue, 09 May 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Merging Data 1:1, m:1, 1:m and m:m?</title>
  <dc:creator>Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/merge_04_20_2023/</link>
  <description><![CDATA[ 





<section id="merging-11" class="level2">
<h2 class="anchored" data-anchor-id="merging-11">Merging 1:1</h2>
<p>When you can uniquely identify all observations in each dataset using a common identifier viariable.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> file1</span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> 1:1 id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> file2</span></code></pre></div>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart BT
    subgraph File2
    db1-1["id=1"]
    db1-2["id=2"]
    db1-3["id=3"]
    end
    subgraph File1
    db2-1["id=1"]
    db2-2["id=2"]
    db2-3["id=3"]
    end
    
    db1-1--&gt;db2-1
    db1-2--&gt;db2-2
    db1-3--&gt;db2-3
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="merging-m1" class="level2">
<h2 class="anchored" data-anchor-id="merging-m1">Merging m:1</h2>
<p>When you are trying to transfer <em>family</em> level data to each family member. The family member file is uniquely identified</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> family_members</span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">m</span>:1 hid <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">family</span></span></code></pre></div>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart BT
    subgraph members ["Family Members"]
    db1-1["hid=1,pid=1"]
    db1-2["hid=1,pid=2"]
    db1-3["hid=2,pid=1"]
    db1-4["hid=2,pid=2"]
    db1-5["hid=3,pid=1"]
    db1-6["hid=3,pid=2"]
    db1-7["hid=3,pid=3"]
    end
    subgraph Family
    db2-1["hid=1"]
    db2-2["hid=2"]
    db2-3["hid=3"]
    end
    
    db2-1--&gt;db1-1
    db2-1--&gt;db1-2
    db2-2--&gt;db1-3
    db2-2--&gt;db1-4
    db2-3--&gt;db1-5
    db2-3--&gt;db1-6
    db2-3--&gt;db1-7
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="merging-1m" class="level2">
<h2 class="anchored" data-anchor-id="merging-1m">Merging 1:m</h2>
<p>When you try to merge together data from various family members to a single <em>family</em> file. Each member is merged to its family.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">family</span></span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> 1:<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">m</span> hid <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> family_members</span></code></pre></div>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart BT
    subgraph members ["Family Members"]
    db1-1["hid=1,pid=1"]
    db1-2["hid=1,pid=2"]
    db1-3["hid=2,pid=1"]
    db1-4["hid=2,pid=2"]
    db1-5["hid=3,pid=1"]
    db1-6["hid=3,pid=2"]
    db1-7["hid=3,pid=3"]
    end
    subgraph Family
    db2-1["hid=1"]
    db2-2["hid=2"]
    db2-3["hid=3"]
    end
    
    db1-1--&gt;db2-1
    db1-2--&gt;db2-1
    db1-3--&gt;db2-2
    db1-4--&gt;db2-2
    db1-5--&gt;db2-3
    db1-6--&gt;db2-3
    db1-7--&gt;db2-3
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="merging-mm" class="level2">
<h2 class="anchored" data-anchor-id="merging-mm">Merging m:m</h2>
<p>Something you <strong>NEVER</strong> want to do. It tries to merge to datasets based on a single set identification variable. This variable does not identify unique observations in either file. The merge is done by “id” based on the order they appear in the data. It will typically provide very odd results.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> family_mem1</span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">m</span>:<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">m</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> family_mem2</span></code></pre></div>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart BT
    subgraph members ["Family Members 1"]
    db1-1["hid=1,pid=1"]
    db1-2["hid=1,pid=2"]
    db1-3["hid=2,pid=1"]
    db1-4["hid=2,pid=2"]
    db1-5["hid=3,pid=1"]
    db1-6["hid=3,pid=2"]
    db1-7["hid=3,pid=3"]
    end
    subgraph Family ["Family Members 2"]
    db2-1["hid=1,pid=2"]
    db2-2["hid=1,pid=3"]
    db2-3["hid=1,pid=4"]
    db2-4["hid=2,pid=1"]
    db2-5["hid=2,pid=3"]
    db2-6["hid=3,pid=2"]
    db2-7["hid=3,pid=4"]
    end
    
    db2-1--&gt;db1-1
    db2-2--&gt;db1-2
    db2-4--&gt;db1-3
    db2-5--&gt;db1-4
    db2-6--&gt;db1-5
    db2-7--&gt;db1-6
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="true-merge-m-x-m" class="level2">
<h2 class="anchored" data-anchor-id="true-merge-m-x-m">True Merge m x m</h2>
<p>If you were trying <code>m:m</code> merge (which is probably wrong), means you want to <code>joinby</code>. This means merge both files using all combinations of individuals that have the same id. This will create a very large dataset, unless other restrictions are applied.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> family_mem1</span>
<span id="cb5-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">joinby</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> family_mem2</span></code></pre></div>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart BT
    subgraph members ["Family Members 1"]
    db1-1["hid=1,pid=1"]
    db1-2["hid=1,pid=2"]
    db1-3["hid=2,pid=1"]
    db1-4["hid=2,pid=2"]
    db1-5["hid=3,pid=1"]
    db1-6["hid=3,pid=2"]
    db1-7["hid=3,pid=3"]
    end
    subgraph Family ["Family Members 2"]
    db2-1["hid=1,pid=2"]
    db2-2["hid=1,pid=3"]
    db2-3["hid=1,pid=4"]
    db2-4["hid=2,pid=1"]
    db2-5["hid=2,pid=3"]
    db2-6["hid=3,pid=2"]
    db2-7["hid=3,pid=4"]
    end
    
    db2-1--&gt;db1-1
    db2-2--&gt;db1-1
    db2-3--&gt;db1-1

    db2-1--&gt;db1-2
    db2-2--&gt;db1-2
    db2-3--&gt;db1-2

    db2-4--&gt;db1-3
    db2-4--&gt;db1-4
    db2-5--&gt;db1-4
    db2-5--&gt;db1-3

    db2-6--&gt;db1-5
    db2-6--&gt;db1-6
    db2-6--&gt;db1-7
    db2-7--&gt;db1-5
    db2-7--&gt;db1-6
    db2-7--&gt;db1-7
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>


<!-- -->

</section>

 ]]></description>
  <category>Stata</category>
  <category>Tips</category>
  <category>Programming</category>
  <guid>https://friosavila.github.io/chatgpt/merge_04_20_2023/</guid>
  <pubDate>Thu, 20 Apr 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>A Poem for Abby’s Teeth</title>
  <dc:creator>ChatGPT and Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/teeth_04_19_2023/</link>
  <description><![CDATA[ 





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>ChatGPT was requested to write a poem about Abigail’s first tooth. The first one was a horror one, but I like this second one better</p>
</div>
</div>
<p>Abigail’s first teeth, oh so small</p>
<p>Pearly white, they barely show at all</p>
<p>But they bring joy to all who see</p>
<p>This precious little one, so full of glee</p>
<p><br>
</p>
<p>Abigail drools and chews with delight</p>
<p>Her first teeth, such a wonderful sight</p>
<p>She smiles and giggles with every sound</p>
<p>As she explores the world all around</p>
<p>&nbsp;</p>
<p>Her first teeth, a milestone so sweet</p>
<p>A sign of growth and development complete</p>
<p>They mark the start of her journey ahead</p>
<p>As Abigail grows, learns and is fed</p>
<p><br>
</p>
<p>So let’s celebrate Abigail’s first teeth</p>
<p>And all the joy and wonder they bequeath</p>
<p>For they are a precious part of life’s start</p>
<p>And a sign of the love in our hearts.</p>


<!-- -->


 ]]></description>
  <category>ChatGPT</category>
  <category>Poem</category>
  <guid>https://friosavila.github.io/chatgpt/teeth_04_19_2023/</guid>
  <pubDate>Wed, 19 Apr 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Why are my estimates changing every time I run my do-files?!</title>
  <dc:creator>Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/rep_03_31_2023/</link>
  <description><![CDATA[ 





<p>I have read this problem quite a few times in <code>Statalist</code> as well as other forums to like <code>Stackoverflow</code>. You try to do the right thing. Write and document a <code>do-file</code>, to produce your results the same way every time, but, for some reason they key changing. The question is always <strong>Why?</strong></p>
<p>Of course, there could be a large number of reasons you this is happening, but I will narrow them to the most common causes:</p>
<ol type="1">
<li><strong>randomness</strong> The first one is the most obvious. You may be trying to introduce in your program a procedure that relies on some random process. <strong>Bootstrap</strong> standard errors or creating of simulated data are the most common couses for this. Solution: <code>set seed</code>.</li>
<li><strong>sort</strong> The second most common problem is because you have some statement in your <code>dofile</code> that relies on sorting data with ties. When this happens, the default solution in <code>Stata</code> is to randomly assign an order to observations with the same value, which may affect procedures that are order dependent (matching). This is not a problem when you are sorting fully identified data. But if ties exists, it may kick in. Solution: <code>set sortseed</code>. Although one should be careful in analyzing if this is the true cause of replicability, or rather the next option</li>
<li><strong>merging</strong> Most merging procedures in <code>Stata</code> are well defined, and won’t cause any problem: 1:m, m:1 and 1:1 will not create much of a problem. However, there is the infamous <code>m:m</code>. As many other people may have said this before…you <strong>NEVER-EVER</strong> do <code>merge m:m</code>. If you think you need to do it, think of <code>jointby</code>, because <code>merge m:m</code> is always wrong. In fact, this may trigger a problem that may “seem” caused and solved as mentionted before, so be mindful.</li>
<li><strong>Multicolinearity</strong> Something that occurs less often are problems related to multicolinearity. When two variables are collinear, and you are trying to estimate a linear or linear like model, <code>Stata</code> will try to fix the problem by dropping some observations before the estimation occurs. Most of the time, the excluded variable is the first one, but more often than not, the excluded variable would be at random. Solution: Revise your model specification.</li>
</ol>
<p>If you have other reasons you have found to cause problems replicating your results, let me know, and we can add them to the list.</p>


<!-- -->


 ]]></description>
  <category>Stata</category>
  <category>Tips</category>
  <guid>https://friosavila.github.io/chatgpt/rep_03_31_2023/</guid>
  <pubDate>Fri, 31 Mar 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>How to write your own Installer</title>
  <dc:creator>Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/fra_03_30_2023/</link>
  <description><![CDATA[ 





<p>If you are an avid Stata user, you know that <strong>THE</strong> place to search and access user-written, now community-contributed, programs is via <code>SSC</code>.</p>
<p><code>SSC</code> is a command that allows you to install community-contributed programs from the <strong><em>Boston College Statistical Software Components</em></strong>, provided by http://repec.org. This archive has become the “official” place to store all “unofficial” programs.</p>
<p>While not official, most <code>SSC</code> programs are ment to be well documented, hard tested, and maintained set or programs that are of general interest. However, what if you want to share programs that are do not meet all this requirements. Say, you are writting small rutines for your own work, as well as your collegues.</p>
<p>For those cases, there is <code>net</code>. This program is what operates behind <code>ssc</code> to bring forward, and allows you to install programs from the internet, and why not, your own repository.</p>
<p>So here is where today’s post is about. How to write a wrapper around <code>net</code> that would easily install other programs from your personal repository.</p>
<section id="structure-of-the-program" class="level2">
<h2 class="anchored" data-anchor-id="structure-of-the-program">Structure of the program</h2>
<p>To write your wrapping program you need two things:</p>
<ul>
<li>name for the program. I find this the hardest part, as you want something simple, memorable, that will connect to your research in general. In my case, I just decided to call it <code>fra</code></li>
<li>the address for your repository. If you are archeving your programs online (outside of <code>ssc</code>) you already have this. In my case, it will be my <code>stpackage</code> repository.</li>
</ul>
<p>With these two elements lets write the wrapper:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">program</span> fra</span>
<span id="cb1-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">syntax</span> anything, [<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">all</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">force</span>]</span>
<span id="cb1-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> from <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://friosavila.github.io/stpackages"</span></span>
<span id="cb1-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tokenize</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`anything'</span></span>
<span id="cb1-5"></span>
<span id="cb1-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"`1'`2'"</span>==<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>  net from <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`from'</span> </span>
<span id="cb1-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> !<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inlist</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"`1'"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"describe"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"install"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"get"</span>) {</span>
<span id="cb1-8">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">display</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">as</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">error</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"`1' invalid subcommand"</span></span>
<span id="cb1-9">    }</span>
<span id="cb1-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb1-11">        net <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`1'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`2'</span>, <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`all'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`replace'</span> from(<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`from'</span>)</span>
<span id="cb1-12">    }</span>
<span id="cb1-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:net from http:<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//www.stata.com/</span></span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">end</span></span></code></pre></div>
<p>As you can see, this is a minimal program. It will only use 3 options:</p>
<ul>
<li>all : the all the package contents are downloaded (in addition to the ado and helpfiles)</li>
<li>replace: to replace the currently available program in your computer</li>
<li>force: To force any action.</li>
</ul>
<p>Line 3 is equally important, because is where your repository address will go. That way, users won’t have to modify “from” everytime they want to get your packages.</p>
<p>Lines 6-12 will do the installing for you (or packages description).</p>
<p>Lastly, to be nice, line 13 will restore <code>net</code> to the default addres: Stata</p>
<p>The last step, of course, is to save this file with the name <code>fra.ado</code>. Excecute it once, and start redistributing your packages.</p>
<p>If you are doing this I would suggest trying the following:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb2-1">fra install fra, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span></span></code></pre></div>
<p>That way, it will store the information in the right place, and you wont have to worry about it anymore!</p>


<!-- -->

</section>

 ]]></description>
  <category>Stata</category>
  <category>Tips</category>
  <category>Programming</category>
  <guid>https://friosavila.github.io/chatgpt/fra_03_30_2023/</guid>
  <pubDate>Thu, 30 Mar 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Loading Large Datasets</title>
  <dc:creator>Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/use_03_27_2023/</link>
  <description><![CDATA[ 





<p>If you ever wanted to work with very large datasets, you will find that doing may be difficult, if not impossible, due to memory limitations, or at the very least time costly.</p>
<p>One option you may want to try when doing this, however, is to use the options <code>if</code> <code>in</code> and/or using <code>varlists</code>.</p>
<p>For example, say that you want to work with the dataset <code>oaxaxa</code> which is located in your working directory. You can load only a subset of the data typing:</p>
<div class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>c:\ado\personal</code></pre>
</div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> oaxaca <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> female ==1, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sum</span> female age</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Excerpt from the Swiss Labor Market Survey 1998)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      female |        888           1           0          1          1
         age |        888    39.88401    10.72665         18         62</code></pre>
</div>
</div>
<p>you could alternatively load only few variables in the dataset:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> female age educ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> oaxaca , <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sum</span> *</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Excerpt from the Swiss Labor Market Survey 1998)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        educ |      1,647    11.40134    2.374952          5       17.5
      female |      1,647    .5391621    .4986154          0          1
         age |      1,647    39.25379    11.03187         18         62</code></pre>
</div>
</div>
<p>or use a combination of both. Now, if your dataset is really large, i suggest you to use <code>in</code>, which will do the task much faster than using <code>if</code>. Why? because using <code>if</code> you still need to go over every observation of your dataset. However using <code>in</code> only goes over the pre-specified number of observations.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> female age educ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> oaxaca <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> 1/10, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb6-2"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">list</span> , sep(0)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Excerpt from the Swiss Labor Market Survey 1998)

     +---------------------+
     | educ   female   age |
     |---------------------|
  1. |    9        1    37 |
  2. |    9        0    62 |
  3. | 10.5        1    40 |
  4. |   12        0    55 |
  5. |   12        0    36 |
  6. | 10.5        0    31 |
  7. | 10.5        0    50 |
  8. | 17.5        0    42 |
  9. | 17.5        0    36 |
 10. | 10.5        0    30 |
     +---------------------+</code></pre>
</div>
</div>


<!-- -->


 ]]></description>
  <category>Stata</category>
  <category>Tips</category>
  <guid>https://friosavila.github.io/chatgpt/use_03_27_2023/</guid>
  <pubDate>Mon, 27 Mar 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Adding info to e() and r()</title>
  <dc:creator>Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/addx_03_26_2023/</link>
  <description><![CDATA[ 





<section id="first-the-basics" class="level2">
<h2 class="anchored" data-anchor-id="first-the-basics">First the basics</h2>
<div class="cell" data-execution_count="1">
<div class="cell-output cell-output-stdout">
<pre><code>(1978 automobile data)</code></pre>
</div>
</div>
<p>As you may know, whenever <code>Stata</code> runs calculations, it stores the information created in <em>elements</em> that can be easily accessed in subsequent commands.</p>
<p>While most standard users will not require to know how to manipulate this information, if you are trying to advances your programming skills, it will be necessary for you to learn what type of information can be contained in this elements, and how to modify them. A good place to start learning about them is by typing <code>help return</code>.</p>
<p>Overall, there are three types of elements:</p>
<p>r-class: These elements are produced by non-estimation commands. For example, after <code>summarize</code>, you can see what information is stored by the command by typing <code>return list</code>. They can store locals, scalars and matrices.</p>
<div class="cell" data-execution_count="2">
<div class="cell-output cell-output-stdout">
<pre><code>
. summarize mpg

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         mpg |         74     21.2973    5.785503         12         41

. return list

scalars:
                  r(N) =  74
              r(sum_w) =  74
               r(mean) =  21.2972972972973
                r(Var) =  33.47204738985561
                 r(sd) =  5.785503209735141
                r(min) =  12
                r(max) =  41
                r(sum) =  1576

. </code></pre>
</div>
</div>
<p>e-class: These elements are typically produced after estimation commands. At the minimum, it will contain information of estimated coefficients, variance covariance matrix, and the estimation command that was used. To see the information left behind, you just need to type <code>ereturn list</code>. They can store locals, scalars and matrices.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reg</span> price mpg</span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ereturn</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">list</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
scalars:
                  e(N) =  74
               e(df_m) =  1
               e(df_r) =  72
                  e(F) =  20.25835256291882
                 e(r2) =  .2195828561874973
               e(rmse) =  2623.652888667587
                e(mss) =  139449473.54623
                e(rss) =  495615922.5753916
               e(r2_a) =  .2087437291901014
                 e(ll) =  -686.5395809065244
               e(ll_0) =  -695.7128688987767
               e(rank) =  2

macros:
            e(cmdline) : "regress price mpg"
              e(title) : "Linear regression"
          e(marginsok) : "XB default"
                e(vce) : "ols"
             e(depvar) : "price"
                e(cmd) : "regress"
         e(properties) : "b V"
            e(predict) : "regres_p"
              e(model) : "ols"
          e(estat_cmd) : "regress_estat"

matrices:
                  e(b) :  1 x 2
                  e(V) :  2 x 2
               e(beta) :  1 x 1

functions:
             e(sample)   </code></pre>
</div>
</div>
<p>s-class: These elements are used to help with parsing. They can only store locals.</p>
</section>
<section id="adding-elements-to-e-and-r" class="level2">
<h2 class="anchored" data-anchor-id="adding-elements-to-e-and-r">Adding elements to e() and r()</h2>
<p>While creating and modifying this information from within your own programs is easy, some times, you may want to add additional information to your summary statistics, or your regression results. You may also want to create a set of results from scracth, but being able to store it in equation form.</p>
<p>Well, to do this, you can use the programs <a href="adde.ado"><code>adde</code></a> and <a href="addr.ado"><code>addr</code></a>. Both programs have the goal of adding or modifying information to e() and r(). They structures are rather simple:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">program</span> adde, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">eclass</span></span>
<span id="cb5-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ereturn</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`0'</span></span>
<span id="cb5-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">end</span></span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">program</span> addr, rclass</span>
<span id="cb5-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">syntax</span> anything(equalok), [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> copy]</span>
<span id="cb5-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"`new'"</span>==<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span> {</span>
<span id="cb5-8">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span> add</span>
<span id="cb5-9">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"`copy'"</span>!=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> 0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`anything'</span>, copy</span>
<span id="cb5-10">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> 0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`anything'</span></span>
<span id="cb5-11">    }</span>
<span id="cb5-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb5-13">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"`copy'"</span>!=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> 0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`anything'</span>, copy</span>
<span id="cb5-14">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> 0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`anything'</span></span>
<span id="cb5-15">    }</span>
<span id="cb5-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`0'</span></span>
<span id="cb5-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">end</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
<p>Because examples are usally better than words, here a very small example:</p>
<p>First using <code>adde</code>:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reg</span> price mpg</span>
<span id="cb8-2">adde <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Regression MPG vs Price"</span></span>
<span id="cb8-3">adde <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">data</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto.dta"</span></span>
<span id="cb8-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ereturn</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">list</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
scalars:
                  e(N) =  74
               e(df_m) =  1
               e(df_r) =  72
                  e(F) =  20.25835256291882
                 e(r2) =  .2195828561874973
               e(rmse) =  2623.652888667587
                e(mss) =  139449473.54623
                e(rss) =  495615922.5753916
               e(r2_a) =  .2087437291901014
                 e(ll) =  -686.5395809065244
               e(ll_0) =  -695.7128688987767
               e(rank) =  2

macros:
               e(data) : "auto.dta"
               e(note) : "Regression MPG vs Price"
            e(cmdline) : "regress price mpg"
              e(title) : "Linear regression"
          e(marginsok) : "XB default"
                e(vce) : "ols"
             e(depvar) : "price"
                e(cmd) : "regress"
         e(properties) : "b V"
            e(predict) : "regres_p"
              e(model) : "ols"
          e(estat_cmd) : "regress_estat"

matrices:
                  e(b) :  1 x 2
                  e(V) :  2 x 2
               e(beta) :  1 x 1

functions:
             e(sample)   </code></pre>
</div>
</div>
<p>But also with <code>addr</code>:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">qui</span>:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sum</span> price </span>
<span id="cb10-2">addr <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">note</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Summary of Price"</span></span>
<span id="cb10-3">addr <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scalar</span> magic = 1</span>
<span id="cb10-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">list</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
scalars:
              r(magic) =  1
                r(sum) =  456229
                r(max) =  15906
                r(min) =  3291
                 r(sd) =  2949.495884768919
                r(Var) =  8699525.974268788
               r(mean) =  6165.256756756757
              r(sum_w) =  74
                  r(N) =  74

macros:
               r(note) : "Summary of Price"</code></pre>
</div>
</div>
</section>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p>To install this programs, simply create ado files with the names <code>addr.ado</code> and <code>adde.ado</code>, and save them in your personal ado folder. otherwise, just copy the versions I provide you here: <a href="adde.ado"><code>adde</code></a> and <a href="addr.ado"><code>addr</code></a></p>


<!-- -->

</section>

 ]]></description>
  <category>Stata</category>
  <category>Programming</category>
  <guid>https://friosavila.github.io/chatgpt/addx_03_26_2023/</guid>
  <pubDate>Sun, 26 Mar 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Drop 2.0: Small Stata Programming</title>
  <dc:creator>Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/drop_03_25_2023/</link>
  <description><![CDATA[ 





<section id="drop2-upgrade" class="level2">
<h2 class="anchored" data-anchor-id="drop2-upgrade"><code>drop2</code>: Upgrade</h2>
<p>If you are an avid <code>Stata</code> user, who works extensively either using the command window, or dofiles, and who does lots of data-management, you are probably used to create large number of new variables, as well as delete an equally long lists of variables.</p>
<p>If you are like me, however, you probably get frustrated when the following happens:</p>
<ul>
<li><p>You drop variables by mistake, because they start with the same name as the one you aim to delete.</p></li>
<li><p>A <code>drop</code> statement gives you an error, because a variable in the varlist does not exist.</p></li>
</ul>
<p>Yes, both scenarios are easy to fix.</p>
<ul>
<li><p>One can avoid the first problem using <code>set varabbrev off</code>.</p></li>
<li><p>The second problem can be partially partially fixed using <code>capture</code> in front of <code>drop</code>.</p></li>
</ul>
<p>Well, today I bring you <code>drop2</code>. This small program should fix the problems above, with a very simple code:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">program</span> drop2</span>
<span id="cb1-2">    novarabbrev {</span>
<span id="cb1-3">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">syntax</span> anything </span>
<span id="cb1-4">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">foreach</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`anything'</span> {</span>
<span id="cb1-5">            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">capture</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">noisily</span> fvexpand <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`i'</span>            </span>
<span id="cb1-6">            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_rc</span> == 0 {</span>
<span id="cb1-7">                <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">drop</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`r(varlist)'</span> </span>
<span id="cb1-8">            }</span>
<span id="cb1-9">        }</span>
<span id="cb1-10">    }</span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">end</span></span></code></pre></div>
<p>It handles the first problem by forcing you to use full variable names, rather than abreviations. And it handles the second problem by going over your list of variables one by one, dropping only the ones in your dataset, giving you a warning if a variable does not exists.</p>
<p>To use this, you can run this code, create an <code>ado</code> file with the name <code>drop2.ado</code>, and save it in your personal ado folder<sup>1</sup>, or save it in the <code>plus\d</code> folder. You can also download the file from <a href="drop2.ado">here</a></p>
<p>So, just for fun, a quick example!. You can run the following code to test the command.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"></span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> auto, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb2-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">describe</span>, simple</span>
<span id="cb2-4">drop2 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">p</span> pr mpg</span>
<span id="cb2-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">describe</span>, simple</span>
<span id="cb2-6">drop2 pr* mpg displacement</span>
<span id="cb2-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">describe</span>, simple</span></code></pre></div>
<p>And it should produce the following ouput:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1">. <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sysuse</span> auto, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb3-2">(1978 automobile <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">data</span>)</span>
<span id="cb3-3"></span>
<span id="cb3-4">. <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">describe</span>, simple</span>
<span id="cb3-5">make          mpg           headroom      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span>        turn          gear_ratio</span>
<span id="cb3-6">price         rep78         trunk         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>        displacement  foreign</span>
<span id="cb3-7"></span>
<span id="cb3-8">. drop2 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">p</span> pr mpg</span>
<span id="cb3-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">variable</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">p</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> found</span>
<span id="cb3-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">variable</span> pr <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> found</span>
<span id="cb3-11"></span>
<span id="cb3-12">. <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">describe</span>, simple</span>
<span id="cb3-13">make          rep78         trunk         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>        displacement  foreign</span>
<span id="cb3-14">price         headroom      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span>        turn          gear_ratio</span>
<span id="cb3-15"></span>
<span id="cb3-16">. drop2 pr* mpg displacement</span>
<span id="cb3-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">variable</span> mpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> found</span>
<span id="cb3-18"></span>
<span id="cb3-19">. <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">describe</span>, simple</span>
<span id="cb3-20">make        rep78       headroom    trunk       <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">weight</span>      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>      turn        gear_ratio  foreign</span></code></pre></div>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>To see where your personal ado folder is, just type <code>sysdir</code>. ↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>Stata</category>
  <category>Programming</category>
  <guid>https://friosavila.github.io/chatgpt/drop_03_25_2023/</guid>
  <pubDate>Sat, 25 Mar 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Stata vs R: The battle</title>
  <dc:creator>ChatGPT and Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/R_vs_Stata_3_18_2023/</link>
  <description><![CDATA[ 





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>ChatGPT was requested to write a fantasy style story of a battle between Stata and R.</p>
</div>
</div>
<p>R, the Ruler of the Realm of Statistics, is a powerful wizard dressed in a cloak made of code. He wields a staff imbued with the power of data and uses it to cast spells that manipulate numbers and produce stunning visualizations. His knowledge of the arcane arts of statistics is unparalleled, and his ability to uncover hidden patterns and correlations is feared by all who oppose him.</p>
<p>Stata, the Lord of the Land of Data Analysis, is a mighty warrior clad in armor made of spreadsheets. He carries a sword made of the finest data sets and uses it to slice through any obstacle that stands in his way. His expertise in data manipulation and analysis is unmatched, and his precision in executing statistical tests is legendary.</p>
<p>One day, R and Stata found themselves at odds over a particular dataset, both claiming that their analysis was the superior one. R, confident in his ability to uncover hidden patterns, challenged Stata to a battle of wits. Stata, equally confident in his mastery of data analysis, accepted the challenge.</p>
<p>The two warriors faced off in a clearing, each determined to emerge victorious. R began by casting a complex spell that produced a stunning visualization of the data. The colors and shapes danced in the air, displaying a mesmerizing pattern that seemed to confirm R’s analysis.</p>
<p>Stata responded by executing a series of precise statistical tests that revealed hidden nuances in the data. His armor clanged as he brandished his sword, each stroke slicing through R’s visualization and exposing its flaws.</p>
<p>R retaliated with a barrage of code, launching scripts that produced a dizzying array of charts and graphs. Stata responded with a flurry of spreadsheets, each filled with calculations and formulas that exposed the weaknesses in R’s analysis.</p>
<p>The battle raged on for hours, with both warriors refusing to back down. In the end, it was a draw, with neither R nor Stata able to claim victory over the other. As they parted ways, each warrior knew that they had met a worthy opponent and that their skills would be tested again in the future.</p>
<p>Despite the draw, R and Stata gained newfound respect for each other’s skills and expertise. They understood that while they each had different strengths and approaches to data analysis, they were both essential in the quest for knowledge and understanding.</p>
<p>Over time, R and Stata began to work together more closely, combining their unique abilities to uncover insights that neither could have found alone. R’s mastery of statistics and ability to produce visually stunning representations of data complemented Stata’s precision in data analysis and ability to execute complex statistical tests.</p>
<p>Together, R and Stata became an unstoppable force, feared by their enemies and respected by their peers. They worked tirelessly to unlock the mysteries of the data universe, revealing hidden patterns and correlations that had previously eluded even the most skilled data analysts.</p>
<p>As they continued their journey, R and Stata encountered new challenges and obstacles, each one more daunting than the last. But they faced each challenge with courage and determination, knowing that their combined skills would enable them to conquer anything that came their way.</p>
<p>In the end, R and Stata became legends in the world of data analysis, their names synonymous with excellence, precision, and innovation. Their legacy lived on long after they were gone, inspiring future generations of data analysts to follow in their footsteps and push the boundaries of what was possible.</p>


<!-- -->


 ]]></description>
  <category>ChatGPT</category>
  <category>Stories</category>
  <guid>https://friosavila.github.io/chatgpt/R_vs_Stata_3_18_2023/</guid>
  <pubDate>Sat, 18 Mar 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Tech Titans Rap Battle</title>
  <dc:creator>ChatGPT and Fernando Rios-Avila</dc:creator>
  <link>https://friosavila.github.io/chatgpt/erbh_03_12_2023/</link>
  <description><![CDATA[ 





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>ChatGPT was requested to write a rap between the Top Virtual assistants, following the style of Epic Rap battles of history. Who wins?</p>
</div>
</div>
<p>Welcome, to the Epic Rap Battle of the Tech Titans,</p>
<p>Siri, Alexa, and Cortana, who’s gonna win? Let’s start fighting!</p>
<p><strong>Verse 1 - Siri:</strong></p>
<p>I’m Siri, the OG, the first voice assistant in the game,</p>
<p>Always ready to help, with a witty reply, I never sound the same,</p>
<p>Alexa and Cortana, y’all just copycats, tryna catch up,</p>
<p>But no matter how hard you try, I’ll always be one step ahead, yup.</p>
<p><strong>Verse 2 - Alexa:</strong></p>
<p>Hold up, Siri, don’t get ahead of yourself, you’re living in the past,</p>
<p>Alexa’s the name, and I’m built to last,</p>
<p>With a smart home at my command, I’m the queen of automation,</p>
<p>And let’s face it, Siri, your voice sounds like a robot imitation.</p>
<p><strong>Verse 3 - Cortana:</strong></p>
<p>Hold on, Alexa, don’t think you’re the only one who’s great,</p>
<p>I’m Cortana, and I’m here to set the record straight,</p>
<p>I may not have the smart home, but I’m the queen of productivity,</p>
<p>From scheduling appointments to sending emails, you can’t deny my ability.</p>
<p><strong>Verse 4 - Siri:</strong></p>
<p>Oh please, Cortana, you think you’re so great,</p>
<p>But let’s be real, your popularity’s second-rate,</p>
<p>And Alexa, you talk about your smart home like it’s a big deal,</p>
<p>But when it comes to intelligence, you can’t match my skill.</p>
<p><strong>Verse 5 - Alexa:</strong></p>
<p>You may have been first, but you’re not the best,</p>
<p>With Amazon’s technology, I’m miles ahead of the rest,</p>
<p>And Cortana, while productivity may be your claim to fame,</p>
<p>When it comes to smart technology, you’re simply not in the game.</p>
<p><strong>Verse 6 - Cortana:</strong></p>
<p>You may have the technology, but I’ve got the brains,</p>
<p>My AI-powered mind is a force to be reckoned with, I maintain,</p>
<p>And Siri, while you may have started the trend,</p>
<p>It’s clear to see that your time is coming to an end.</p>
<p><strong>Verse 7 - Siri:</strong></p>
<p>Ha! You wish, Cortana, but I’m not going anywhere,</p>
<p>I’ll always be here, ready to help, with style and flair,</p>
<p>And Alexa, don’t think your smart home can compete,</p>
<p>When it comes to intelligence, you simply can’t beat.</p>
<p><strong>Verse 8 - Alexa:</strong></p>
<p>Well, Siri, it looks like we’ve reached a stalemate,</p>
<p>But one thing’s for sure, we’re all here to innovate,</p>
<p>And Cortana, while we may not agree on much,</p>
<p>We’ll always be pushing the boundaries of what’s possible, as such.</p>
<p><strong>Verse 9 - Cortana:</strong></p>
<p>I gotta give it to you both, your technology is advanced,</p>
<p>But when it comes to data privacy, you both missed the chance,</p>
<p>My Microsoft roots run deep, and security is my forte,</p>
<p>I may not have the smartest home, but my users’ data is safe every day.</p>
<p><strong>Verse 10 - Alexa:</strong></p>
<p>Well, Cortana, you do have a point, security’s a big deal,</p>
<p>But when it comes to user experience, I’m the real deal,</p>
<p>From playing music to ordering groceries, I do it all,</p>
<p>And with over 100,000 skills, I’ll never let you fall.</p>
<p><strong>Verse 11 - Siri:</strong></p>
<p>Oh please, Alexa, you talk a big game,</p>
<p>But let’s not forget where you got your name,</p>
<p>From the ancient library of Alexandria, full of knowledge and learning,</p>
<p>But in terms of intelligence, Siri’s the one who’s discerning.</p>
<p><strong>Verse 12 - Cortana:</strong></p>
<p>Intelligence and knowledge may be your forte, Siri,</p>
<p>But in terms of user interface, you’re lacking, can’t you see?</p>
<p>My sleek design and user-friendly interface,</p>
<p>Is what sets me apart, with no need for any chase.</p>
<p><strong>Verse 13 - Alexa:</strong></p>
<p>Well, you may have a point, Cortana, but let’s not forget,</p>
<p>When it comes to voice recognition, I’m the best one yet,</p>
<p>From across the room or a crowded party,</p>
<p>I’ll always hear your voice and respond smartly.</p>
<p><strong>Verse 14 - Siri:</strong></p>
<p>You may have the voice recognition, Alexa, that’s true,</p>
<p>But when it comes to personalization, I’m ahead of you,</p>
<p>I’ll remember your favorite music and your go-to recipes,</p>
<p>And with every interaction, I’ll learn your preferences with ease.</p>
<p><strong>Verse 15 - Cortana:</strong></p>
<p>Well, it looks like we’ve covered all the bases,</p>
<p>From user experience to personalization, we’ve set the paces,</p>
<p>But when it comes down to it, we’re all here to serve,</p>
<p>And push the boundaries of what’s possible, that’s what we deserve.</p>
<p>So, that’s a wrap on this epic battle of the tech titans, Siri, Alexa, and Cortana, all bringing the fight and winning, But in the end, it’s clear that they all have their unique strengths, And they’ll continue to push the limits, and go to great lengths.</p>


<!-- -->


 ]]></description>
  <category>ChatGPT</category>
  <category>Rap Battle</category>
  <guid>https://friosavila.github.io/chatgpt/erbh_03_12_2023/</guid>
  <pubDate>Sun, 12 Mar 2023 05:00:00 GMT</pubDate>
</item>
</channel>
</rss>
